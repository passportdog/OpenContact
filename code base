## architecture-scout
# OpenContact.ai Frontend Architecture Plan

## Executive Summary

Based on analysis of Supabase documentation, Next.js 14 App Router patterns, and multi-tenant architecture best practices, here's a comprehensive scaffold plan for OpenContact.ai.

---

## 1. Complete Folder Structure (Monorepo)

```
opencontact-ai/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/                          # Main Next.js 14 application
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ app/                  # Next.js App Router
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ (auth)/           # Auth route group
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ signup/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ callback/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ (dashboard)/      # Protected dashboard routes
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contacts/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ conversations/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ (marketing)/      # Public marketing pages
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx      # Landing page
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ pricing/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ api/              # API routes (Edge Functions)
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ webhooks/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ stripe/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ trpc/
â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ [trpc]/
â”‚   â”‚   â”‚   â”‚   â”‚           â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx        # Root layout
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ not-found.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ui/               # shadcn/ui components
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login-form.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ signup-form.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ auth-provider.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contacts/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contact-list.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contact-card.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ contact-form.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ conversations/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ chat-window.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ message-list.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ message-input.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sidebar.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ header.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ mobile-nav.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ shared/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ loading.tsx
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ error-boundary.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ contexts/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ auth-context.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ use-auth.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ use-contacts.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ use-conversations.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ use-realtime.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ browser-client.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ server-client.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ middleware-client.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ utils.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ constants.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ server/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ actions/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contacts.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ conversations.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contacts.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ conversations.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ queries/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ database.ts        # Supabase generated types
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”‚   â””â”€â”€ middleware.ts
â”‚   â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”‚   â”œâ”€â”€ favicon/
â”‚   â”‚   â”‚   â””â”€â”€ og-image.png
â”‚   â”‚   â”œâ”€â”€ next.config.js
â”‚   â”‚   â”œâ”€â”€ tailwind.config.ts
â”‚   â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ docs/                         # Documentation app (optional)
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ db/                           # Shared database package
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â””â”€â”€ migrations/
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ ui/                           # Shared UI components
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ utils/                        # Shared utilities
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â””â”€â”€ index.ts
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ functions/
â”‚   â”‚   â”œâ”€â”€ ai-reply/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ send-notification/
â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ config.toml
â”‚   â””â”€â”€ seed.sql
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json                      # Root package.json (workspaces)
â”œâ”€â”€ turbo.json                        # Turborepo config
â”œâ”€â”€ pnpm-workspace.yaml
â””â”€â”€ README.md
```

---

## 2. Environment Variables Template

```bash
# ============================================
# OpenContact.ai Environment Configuration
# ============================================

# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# New publishable key (recommended)
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY=sb_publishable_xxx

# Database Direct Connection (for migrations)
DATABASE_URL=postgresql://postgres:password@db.your-project.supabase.co:5432/postgres

# App Configuration
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_APP_NAME=OpenContact.ai

# Stripe Configuration
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_xxx
STRIPE_SECRET_KEY=sk_test_xxx
STRIPE_WEBHOOK_SECRET=whsec_xxx

# AI Provider Keys
OPENAI_API_KEY=sk-xxx
ANTHROPIC_API_KEY=sk-ant-xxx

# Email Configuration (Resend)
RESEND_API_KEY=re_xxx
EMAIL_FROM=noreply@opencontact.ai

# Push Notifications (optional)
VAPID_PUBLIC_KEY=xxx
VAPID_PRIVATE_KEY=xxx

# Feature Flags
NEXT_PUBLIC_ENABLE_AI_FEATURES=true
NEXT_PUBLIC_ENABLE_REALTIME=true

# Analytics (optional)
NEXT_PUBLIC_POSTHOG_KEY=phc_xxx
NEXT_PUBLIC_GA_ID=G-xxx

# Development
NODE_ENV=development
```

---

## 3. Package Dependencies

### Root `package.json` (Turborepo)

```json
{
  "name": "opencontact-ai",
  "private": true,
  "scripts": {
    "dev": "turbo dev",
    "build": "turbo build",
    "lint": "turbo lint",
    "type-check": "turbo type-check",
    "db:generate": "turbo db:generate",
    "db:push": "turbo db:push",
    "db:migrate": "supabase migration up"
  },
  "devDependencies": {
    "turbo": "^2.0.0",
    "typescript": "^5.3.0"
  },
  "packageManager": "pnpm@8.15.0"
}
```

### Main App `package.json`

```json
{
  "name": "@opencontact/web",
  "version": "0.1.0",
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "type-check": "tsc --noEmit"
  },
  "dependencies": {
    "next": "^14.2.0",
    "react": "^18.3.0",
    "react-dom": "^18.3.0",
    
    "@supabase/supabase-js": "^2.39.0",
    "@supabase/ssr": "^0.1.0",
    "@supabase/auth-helpers-nextjs": "^0.9.0",
    
    "@tanstack/react-query": "^5.28.0",
    "@trpc/client": "^11.0.0",
    "@trpc/server": "^11.0.0",
    "@trpc/react-query": "^11.0.0",
    "@trpc/next": "^11.0.0",
    
    "zod": "^3.22.0",
    "react-hook-form": "^7.51.0",
    "@hookform/resolvers": "^3.3.0",
    
    "framer-motion": "^11.0.0",
    "date-fns": "^3.6.0",
    "lucide-react": "^0.356.0",
    
    "tailwindcss": "^3.4.0",
    "@radix-ui/react-slot": "^1.0.2",
    "class-variance-authority": "^0.7.0",
    "clsx": "^2.1.0",
    "tailwind-merge": "^2.2.0",
    
    "stripe": "^14.20.0",
    "openai": "^4.28.0",
    "@anthropic-ai/sdk": "^0.24.0",
    
    "react-hot-toast": "^2.4.1",
    "zustand": "^4.5.0"
  },
  "devDependencies": {
    "@types/node": "^20.11.0",
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "typescript": "^5.3.0",
    "eslint": "^8.57.0",
    "eslint-config-next": "^14.2.0",
    "prettier": "^3.2.0",
    "prettier-plugin-tailwindcss": "^0.5.0"
  }
}
```

---

## 4. Supabase Client Initialization Pattern

Based on [supabase.com](https://supabase.com/docs/guides/auth/quickstarts/nextjs) and [makerkit.dev](https://makerkit.dev/courses/nextjs-app-router/authentication), the SSR package is the modern approach:

### Browser Client (`src/lib/supabase/browser-client.ts`)

```typescript
import { createBrowserClient } from '@supabase/ssr';
import { Database } from '@/types/database';

let client: ReturnType<typeof createBrowserClient<Database>> | undefined;

export function getSupabaseBrowserClient() {
  if (client) {
    return client;
  }

  client = createBrowserClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );

  return client;
}
```

### Server Client (`src/lib/supabase/server-client.ts`)

```typescript
import { createServerClient } from '@supabase/ssr';
import { cookies } from 'next/headers';
import { Database } from '@/types/database';

export async function getSupabaseServerClient() {
  const cookieStore = await cookies();

  return createServerClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll();
        },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options)
            );
          } catch {
            // Handle cookie errors in middleware
          }
        },
      },
    }
  );
}
```

### Middleware Client (`src/lib/supabase/middleware-client.ts`)

```typescript
import { createServerClient } from '@supabase/ssr';
import { NextResponse, type NextRequest } from 'next/server';
import { Database } from '@/types/database';

export function getSupabaseMiddlewareClient(request: NextRequest) {
  let response = NextResponse.next({
    request: {
      headers: request.headers,
    },
  });

  const supabase = createServerClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return request.cookies.getAll();
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value }) =>
            request.cookies.set(name, value)
          );
          response = NextResponse.next({
            request: {
              headers: request.headers,
            },
          });
          cookiesToSet.forEach(({ name, value, options }) =>
            response.cookies.set(name, value, options)
          );
        },
      },
    }
  );

  return { supabase, response };
}
```

---

## 5. Auth Middleware Pattern

### Middleware (`src/middleware.ts`)

```typescript
import { createServerClient } from '@supabase/ssr';
import { NextResponse, type NextRequest } from 'next/server';

// Routes that don't require authentication
const publicRoutes = ['/', '/login', '/signup', '/pricing', '/api/webhooks'];
const authRoutes = ['/login', '/signup'];

export async function middleware(request: NextRequest) {
  let response = NextResponse.next({
    request: {
      headers: request.headers,
    },
  });

  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return request.cookies.getAll();
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value }) =>
            request.cookies.set(name, value)
          );
          response = NextResponse.next({
            request: {
              headers: request.headers,
            },
          });
          cookiesToSet.forEach(({ name, value, options }) =>
            response.cookies.set(name, value, options)
          );
        },
      },
    }
  );

  // Get session
  const {
    data: { session },
  } = await supabase.auth.getSession();

  const { pathname } = request.nextUrl;

  // Allow public routes
  const isPublicRoute = publicRoutes.some(
    (route) => pathname === route || pathname.startsWith('/api/')
  );

  // Redirect unauthenticated users to login
  if (!session && !isPublicRoute) {
    const redirectUrl = new URL('/login', request.url);
    redirectUrl.searchParams.set('redirect', pathname);
    return NextResponse.redirect(redirectUrl);
  }

  // Redirect authenticated users away from auth pages
  if (session && authRoutes.includes(pathname)) {
    return NextResponse.redirect(new URL('/dashboard', request.url));
  }

  return response;
}

export const config = {
  matcher: [
    /*
     * Match all request paths except:
     * - _next/static (static files)
     * - _next/image (image optimization files)
     * - favicon.ico (favicon file)
     * - public folder
     */
    '/((?!_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',
  ],
};
```

### Auth Provider (`src/contexts/auth-context.tsx`)

```typescript
'use client';

import {
  createContext,
  useContext,
  useEffect,
  useState,
  type ReactNode,
} from 'react';
import { type User, type Session } from '@supabase/supabase-js';
import { getSupabaseBrowserClient } from '@/lib/supabase/browser-client';

interface AuthContextType {
  user: User | null;
  session: Session | null;
  loading: boolean;
  signOut: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [session, setSession] = useState<Session | null>(null);
  const [loading, setLoading] = useState(true);
  const supabase = getSupabaseBrowserClient();

  useEffect(() => {
    // Get initial session
    supabase.auth.getSession().then(({ data: { session } }) => {
      setSession(session);
      setUser(session?.user ?? null);
      setLoading(false);
    });

    // Listen for auth changes
    const {
      data: { subscription },
    } = supabase.auth.onAuthStateChange((_event, session) => {
      setSession(session);
      setUser(session?.user ?? null);
      setLoading(false);
    });

    return () => {
      subscription.unsubscribe();
    };
  }, []);

  const signOut = async () => {
    await supabase.auth.signOut();
    window.location.href = '/login';
  };

  return (
    <AuthContext.Provider value={{ user, session, loading, signOut }}>
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
}
```

---

## 6. Realtime Subscription Patterns

### Custom Hook (`src/hooks/use-realtime.ts`)

```typescript
'use client';

import { useEffect, useRef } from 'react';
import { getSupabaseBrowserClient } from '@/lib/supabase/browser-client';
import type { RealtimeChannel } from '@supabase/supabase-js';

interface RealtimeConfig {
  channel: string;
  table: string;
  event?: 'INSERT' | 'UPDATE' | 'DELETE' | '*';
  filter?: string;
  onInsert?: (payload: any) => void;
  onUpdate?: (payload: any) => void;
  onDelete?: (payload: any) => void;
}

export function useRealtime({
  channel,
  table,
  event = '*',
  filter,
  onInsert,
  onUpdate,
  onDelete,
}: RealtimeConfig) {
  const supabase = getSupabaseBrowserClient();
  const channelRef = useRef<RealtimeChannel | null>(null);

  useEffect(() => {
    let dbChannel = supabase.channel(channel);

    dbChannel = dbChannel.on(
      'postgres_changes',
      {
        event,
        schema: 'public',
        table,
        filter,
      },
      (payload) => {
        switch (payload.eventType) {
          case 'INSERT':
            onInsert?.(payload);
            break;
          case 'UPDATE':
            onUpdate?.(payload);
            break;
          case 'DELETE':
            onDelete?.(payload);
            break;
        }
      }
    );

    dbChannel.subscribe();
    channelRef.current = dbChannel;

    return () => {
      if (channelRef.current) {
        supabase.removeChannel(channelRef.current);
      }
    };
  }, [channel, table, event, filter]);

  return channelRef;
}
```

### Usage Example - Conversations

```typescript
'use client';

import { useState } from 'react';
import { useRealtime } from '@/hooks/use-realtime';

export function useConversations(contactId: string) {
  const [conversations, setConversations] = useState<Conversation[]>([]);

  useRealtime({
    channel: `conversations:${contactId}`,
    table: 'conversations',
    filter: `contact_id=eq.${contactId}`,
    onInsert: (payload) => {
      setConversations((prev) => [...prev, payload.new]);
    },
    onUpdate: (payload) => {
      setConversations((prev) =>
        prev.map((conv) =>
          conv.id === payload.new.id ? payload.new : conv
        )
      );
    },
  });

  return { conversations, setConversations };
}
```

---

## 7. API Route Structure for Edge Function Calls

### tRPC Setup (`src/app/api/trpc/[trpc]/route.ts`)

```typescript
import { fetchRequestHandler } from '@trpc/server/adapters/fetch';
import { appRouter } from '@/server/trpc/router';
import { getSupabaseServerClient } from '@/lib/supabase/server-client';

const handler = (req: Request) =>
  fetchRequestHandler({
    endpoint: '/api/trpc',
    req,
    router: appRouter,
    createContext: async () => {
      const supabase = await getSupabaseServerClient();
      const {
        data: { session },
      } = await supabase.auth.getSession();

      return {
        supabase,
        session,
      };
    },
  });

export { handler as GET, handler as POST };
```

### tRPC Router (`src/server/trpc/router.ts`)

```typescript
import { router } from './trpc';
import { contactsRouter } from './routers/contacts';
import { conversationsRouter } from './routers/conversations';
import { aiRouter } from './routers/ai';

export const appRouter = router({
  contacts: contactsRouter,
  conversations: conversationsRouter,
  ai: aiRouter,
});

export type AppRouter = typeof appRouter;
```

### Edge Function Proxy (`src/app/api/edge/[...path]/route.ts`)

```typescript
import { NextRequest, NextResponse } from 'next/server';

const SUPABASE_URL = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const ANON_KEY = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

export async function GET(
  request: NextRequest,
  { params }: { params: { path: string[] } }
) {
  return proxyEdgeFunction(request, params.path);
}

export async function POST(
  request: NextRequest,
  { params }: { params: { path: string[] } }
) {
  return proxyEdgeFunction(request, params.path);
}

async function proxyEdgeFunction(
  request: NextRequest,
  pathSegments: string[]
) {
  const functionName = pathSegments.join('/');
  const url = `${SUPABASE_URL}/functions/v1/${functionName}`;

  const headers = new Headers(request.headers);
  headers.set('Authorization', `Bearer ${ANON_KEY}`);

  // Forward auth context
  const authHeader = request.headers.get('Authorization');
  if (authHeader) {
    headers.set('Authorization', authHeader);
  }

  const response = await fetch(url, {
    method: request.method,
    headers,
    body: request.body,
  });

  const data = await response.json();

  return NextResponse.json(data, {
    status: response.status,
    headers: {
      'Content-Type': 'application/json',
    },
  });
}
```

### Webhook Handler (`src/app/api/webhooks/stripe/route.ts`)

```typescript
import { NextRequest, NextResponse } from 'next/server';
import Stripe from 'stripe';
import { getSupabaseServerClient } from '@/lib/supabase/server-client';

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!);
const webhookSecret = process.env.STRIPE_WEBHOOK_SECRET!;

export async function POST(request: NextRequest) {
  const body = await request.text();
  const signature = request.headers.get('stripe-signature')!;

  let event: Stripe.Event;

  try {
    event = stripe.webhooks.constructEvent(body, signature, webhookSecret);
  } catch (error) {
    console.error('Webhook signature verification failed:', error);
    return NextResponse.json({ error: 'Invalid signature' }, { status: 400 });
  }

  const supabase = await getSupabaseServerClient();

  switch (event.type) {
    case 'checkout.session.completed': {
      const session = event.data.object as Stripe.Checkout.Session;
      const userId = session.client_reference_id;

      await supabase.from('subscriptions').upsert({
        user_id: userId,
        stripe_customer_id: session.customer as string,
        status: 'active',
        plan: session.metadata?.plan,
      });
      break;
    }

    case 'customer.subscription.deleted': {
      const subscription = event.data.object as Stripe.Subscription;
      await supabase
        .from('subscriptions')
        .update({ status: 'cancelled' })
        .eq('stripe_customer_id', subscription.customer as string);
      break;
    }
  }

  return NextResponse.json({ received: true });
}
```

---

## Key Takeaways

| Area | Recommendation |
|------|----------------|
| **Supabase Client** | Use `@supabase/ssr` package for server-side auth with cookies |
| **Auth Pattern** | Middleware-based auth with cookie-based sessions |
| **Realtime** | Custom hooks with cleanup, filter by tenant/contact |
| **API Routes** | tRPC for type-safe APIs, proxy for Edge Functions |
| **State** | Zustand for client state, React Query for server state |
| **Folder Structure** | Clear separation of server/client code per [alaminshaikh.com](https://www.alaminshaikh.com/blog/nextjs-app-router-folder-structure-for-full-stack-projects) |

---

## References

- [supabase.com](https://supabase.com/docs/guides/auth/quickstarts/nextjs) - Next.js Auth Quickstart
- [makerkit.dev](https://makerkit.dev/courses/nextjs-app-router/authentication) - SSR package migration guide
- [alaminshaikh.com](https://www.alaminshaikh.com/blog/nextjs-app-router-folder-structure-for-full-stack-projects) - Full-stack folder structure
- [github.com](https://github.com/rgottardi/nextjs-supabase-multitenant) - Multi-tenant architecture reference
- [supabase.com](https://supabase.com/docs/guides/getting-started/tutorials/with-nextjs) - User Management Tutorial

## architecture-scout
# OpenContact.ai Frontend Architecture Plan

## Research Findings Summary

Based on the provided documentation and search results, I've identified several critical patterns and anti-patterns for Supabase + Next.js integration:

### ðŸš¨ Critical Anti-Patterns to Avoid
- **DO NOT** use `@supabase/auth-helpers-nextjs` (deprecated, will break)
- **DO NOT** use individual cookie methods (`get`, `set`, `remove`)
- **MUST** use `@supabase/ssr` with `getAll()` / `setAll()` cookie pattern

---

## 1. Complete Monorepo Folder Structure

```
opencontact-ai/
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â”œâ”€â”€ ci.yml
â”‚   â”‚   â””â”€â”€ deploy.yml
â”‚   â””â”€â”€ CODEOWNERS
â”‚
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/                          # Next.js 14 frontend
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ app/                  # App Router
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ (auth)/           # Auth route group
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ signup/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ callback/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ (dashboard)/     # Protected routes
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contacts/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ campaigns/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx    # Protected layout
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ (marketing)/     # Public routes
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx     # Landing page
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ pricing/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ api/             # API routes
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contacts/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ campaigns/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ generate/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ analyze/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ webhooks/
â”‚   â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ stripe/
â”‚   â”‚   â”‚   â”‚   â”‚       â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ supabase/
â”‚   â”‚   â”‚   â”‚   â”‚           â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx       # Root layout
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ not-found.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ui/               # shadcn/ui components
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ form.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ table.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login-form.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ signup-form.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth-provider.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ protected-route.tsx
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ stats-card.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ recent-activity.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ chart-container.tsx
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contacts/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contact-list.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contact-card.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contact-form.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ contact-import.tsx
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ campaigns/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ campaign-list.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ campaign-builder.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ campaign-analytics.tsx
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ message-generator.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sentiment-analyzer.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ai-suggestions.tsx
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ header.tsx
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ sidebar.tsx
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ footer.tsx
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ mobile-nav.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ browser-client.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ server-client.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ middleware-client.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ use-auth.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ use-contacts.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ use-campaigns.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ use-realtime.ts
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ cn.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ formatters.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ validators.ts
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ constants/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ routes.ts
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ config.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ database.ts        # Supabase generated types
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contact.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ campaign.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ middleware.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”‚   â”œâ”€â”€ favicon.ico
â”‚   â”‚   â”‚   â”œâ”€â”€ logo.svg
â”‚   â”‚   â”‚   â””â”€â”€ og-image.png
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ .env.local
â”‚   â”‚   â”œâ”€â”€ .env.example
â”‚   â”‚   â”œâ”€â”€ next.config.js
â”‚   â”‚   â”œâ”€â”€ tailwind.config.ts
â”‚   â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”‚   â”œâ”€â”€ components.json         # shadcn/ui config
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ docs/                        # Documentation site (optional)
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ shared/                      # Shared utilities
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â””â”€â”€ constants/
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â”‚
â”‚   â””â”€â”€ ui/                          # Shared UI components
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â””â”€â”€ components/
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ functions/                   # Edge Functions
â”‚   â”‚   â”œâ”€â”€ ai-generate/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ ai-analyze/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ stripe-webhook/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ _shared/
â”‚   â”‚       â””â”€â”€ supabase-client.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ migrations/
â”‚   â”‚   â”œâ”€â”€ 20240101000000_initial_schema.sql
â”‚   â”‚   â”œâ”€â”€ 20240102000000_contacts.sql
â”‚   â”‚   â”œâ”€â”€ 20240103000000_campaigns.sql
â”‚   â”‚   â””â”€â”€ 20240104000000_rls_policies.sql
â”‚   â”‚
â”‚   â”œâ”€â”€ seed.sql
â”‚   â””â”€â”€ config.toml
â”‚
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json                     # Root package.json
â”œâ”€â”€ turbo.json                       # Turborepo config
â”œâ”€â”€ pnpm-workspace.yaml
â””â”€â”€ README.md
```

---

## 2. Environment Variables Template

### `.env.local` (apps/web/)

```bash
# ===========================================
# Supabase Configuration
# ===========================================
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# New publishable key format (Supabase 2026+)
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY=sb_publishable_...

# ===========================================
# AI Services (for Edge Functions)
# ===========================================
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...

# ===========================================
# Stripe Configuration
# ===========================================
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_...
STRIPE_SECRET_KEY=sk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...

# ===========================================
# Application Configuration
# ===========================================
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_APP_NAME=OpenContact.ai

# ===========================================
# OAuth Providers (optional)
# ===========================================
# Google OAuth
NEXT_PUBLIC_GOOGLE_OAUTH_ENABLED=true

# GitHub OAuth
NEXT_PUBLIC_GITHUB_OAUTH_ENABLED=false
```

---

## 3. Package Dependencies

### `package.json` (apps/web/)

```json
{
  "name": "@opencontact/web",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "type-check": "tsc --noEmit",
    "db:types": "supabase gen types typescript --project-id $PROJECT_ID > src/types/database.ts"
  },
  "dependencies": {
    "next": "^14.2.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    
    "@supabase/supabase-js": "^2.39.0",
    "@supabase/ssr": "^0.6.0",
    
    "@radix-ui/react-dialog": "^1.0.5",
    "@radix-ui/react-dropdown-menu": "^2.0.6",
    "@radix-ui/react-label": "^2.0.2",
    "@radix-ui/react-select": "^2.0.0",
    "@radix-ui/react-slot": "^1.0.2",
    "@radix-ui/react-toast": "^1.1.5",
    
    "@tanstack/react-query": "^5.17.0",
    "@tanstack/react-table": "^8.11.0",
    
    "react-hook-form": "^7.49.0",
    "@hookform/resolvers": "^3.3.2",
    "zod": "^3.22.4",
    
    "tailwindcss": "^3.4.0",
    "class-variance-authority": "^0.7.0",
    "clsx": "^2.1.0",
    "tailwind-merge": "^2.2.0",
    "lucide-react": "^0.309.0",
    
    "date-fns": "^3.2.0",
    "recharts": "^2.10.0"
  },
  "devDependencies": {
    "@types/node": "^20.11.0",
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "typescript": "^5.3.0",
    "eslint": "^8.56.0",
    "eslint-config-next": "^14.2.0",
    "prettier": "^3.2.0",
    "prettier-plugin-tailwindcss": "^0.5.11"
  }
}
```

---

## 4. Supabase Client Initialization Pattern

### `src/lib/supabase/browser-client.ts`

```typescript
import { createBrowserClient } from '@supabase/ssr'
import type { Database } from '@/types/database'

let client: ReturnType<typeof createBrowserClient<Database>> | undefined

/**
 * Browser-side Supabase client
 * Singleton pattern to prevent multiple instances
 */
export function getSupabaseBrowserClient() {
  if (client) {
    return client
  }

  client = createBrowserClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  )

  return client
}
```

### `src/lib/supabase/server-client.ts`

```typescript
import { createServerClient } from '@supabase/ssr'
import { cookies } from 'next/headers'
import type { Database } from '@/types/database'

/**
 * Server-side Supabase client for Server Components
 * MUST use getAll/setAll cookie pattern
 */
export async function getSupabaseServerClient() {
  const cookieStore = await cookies()

  return createServerClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll()
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value, options }) => {
            try {
              cookieStore.set(name, value, options)
            } catch {
              // Handle cookie setting in middleware context
              // This can fail in Server Components during rendering
            }
          })
        },
      },
    }
  )
}
```

### `src/lib/supabase/middleware-client.ts`

```typescript
import { createServerClient } from '@supabase/ssr'
import { NextResponse, type NextRequest } from 'next/server'
import type { Database } from '@/types/database'

/**
 * Supabase client for middleware
 * Handles auth token refresh in middleware
 */
export function getSupabaseMiddlewareClient(request: NextRequest) {
  let response = NextResponse.next({
    request,
  })

  const supabase = createServerClient<Database>(


## requirements-analyst
Okay, I will proceed with creating detailed technical specifications for the 10 pages of OpenContact.ai, outlining TypeScript interfaces, component hierarchy, state management, user flows, and acceptance criteria, as well as documenting data contracts for the listed Edge Functions.

## OpenContact.ai Page Technical Specifications

**Assumptions:**

*   The project utilizes TypeScript, React, Next.js 14 (App Router), and Tailwind CSS as outlined in the architecture document.
*   Supabase is used for authentication and data persistence.
*   `shadcn/ui` components are available for UI elements.
*   Zod is used for form validation.
*   "@opencontact/shared" & "@opencontact/ui" monorepo packages are available.

### 1. Landing Page `/`

*   **Purpose:** Public-facing marketing page to introduce OpenContact.ai and its features.
*   **User Flow:** User visits the page -> Reads content -> Clicks "Sign Up" or "Login" CTA.

**Technical Specifications:**

*   **TypeScript Interfaces:**
    *   None (static content, no API calls).
*   **Component Hierarchy:**
    ```
    Page (app/page.tsx)
     â”œâ”€â”€ (marketing)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ Header (components/layout/header.tsx)
     â”‚   â”œâ”€â”€ HeroSection
     â”‚   â”œâ”€â”€ FeaturesSection
     â”‚   â”œâ”€â”€ TestimonialsSection
     â”‚   â”œâ”€â”€ PricingPreviewSection
     â”‚   â””â”€â”€ Footer (components/layout/footer.tsx)
    ```
*   **State Management:** None.
*   **Acceptance Criteria:**
    *   Visually appealing and responsive design.
    *   Clear and concise presentation of OpenContact.ai's value proposition.
    *   CTAs link correctly to signup and login pages.
    *   SEO metadata is correctly configured.
*   **Edge Functions Data Contracts**: None

### 2. Login Page `/login`

*   **Purpose:** Allow existing users to authenticate.
*   **User Flow:** User navigates to `/login` -> Enters credentials -> Clicks "Login" -> Redirects to dashboard (`/dashboard`) on success or displays error on failure.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    // Request (Credential-based; could extend for OAuth)
    interface LoginFormValues {
      email: string;
      password?: string;
    }

    //This leverages Supabase's auth response and types.
    type AuthResponse =
      | {
          data: {
            session: Session | null;
            user: User | null;
          };
          error: null;
        }
      | {
          data: {
            session: null;
            user: null;
          };
          error: AuthError;
        };
    ```

*   **Component Hierarchy:**

    ```
    Page (app/(auth)/login/page.tsx)
     â”œâ”€â”€ (auth)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ LoginForm (components/auth/login-form.tsx)
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
     â”‚   â”‚   â””â”€â”€ Link (next/link)
    ```

*   **State Management:**
    *   Form state (using `react-hook-form`)
    *   Loading state
    *   Error state (for displaying login errors).
*   **Acceptance Criteria:**
    *   Form validation with appropriate error messages.
    *   Successful login redirects to `/dashboard`.
    *   Error messages are displayed for invalid credentials or server errors.
    *   "Forgot Password" link is present and functional.
    *   OAuth Login option.
*   **Edge Functions Data Contracts**: None

### 3. Signup Page `/signup`

*   **Purpose:** Allow new users to create an account.
*   **User Flow:** User navigates to `/signup` -> Enters required information -> Clicks "Sign Up" -> Account created; redirected to `/onboarding` or displays error messages.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface SignupFormValues {
      email: string;
      password?: string;
    }
    //This leverages Supabase's auth response and types.
    type AuthResponse =
      | {
          data: {
            session: Session | null;
            user: User | null;
          };
          error: null;
        }
      | {
          data: {
            session: null;
            user: null;
          };
          error: AuthError;
        };
    ```

*   **Component Hierarchy:**

    ```
    Page (app/(auth)/signup/page.tsx)
     â”œâ”€â”€ (auth)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ SignupForm (components/auth/signup-form.tsx)
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
     â”‚   â”‚   â””â”€â”€ Link (next/link)
    ```

*   **State Management:**
    *   Form state (using `react-hook-form`).
    *   Loading state.
    *   Error state.
*   **Acceptance Criteria:**
    *   Form validation with appropriate error messages.
    *   Successful signup creates a new user in Supabase Auth and redirects to `/onboarding`.
    *   Error messages are displayed for invalid input or server errors (e.g., email already exists).
*   **Edge Functions Data Contracts**: None

### 4. Onboarding Page `/onboarding`

*   **Purpose:** Guide new users through initial setup and configuration.
*   **User Flow:** User completes onboarding steps -> Integrates services, sets preferences, etc. -> Redirects to `/scan` or `/dashboard`.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface OnboardingFormValues {
      fullName: string;
      companyName?: string;
      // other settings/preferences
    }

    interface IntegrationStatus {
      service: 'google' | 'stripe' | 'other';
      isConnected: boolean;
    }

    interface UpdateUserMetadataRequest {
        fullName: string;
        companyName?: string;
        // ... other profile fields
    }

    interface UpdateUserMetadataResponse {
        success: boolean;
        error?: string;
    }

    ```

*   **Component Hierarchy:**

    ```
    Page (app/onboarding/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout - since it's a protected route)
     â”‚   â”œâ”€â”€ OnboardingForm
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Select (ui/select.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
     â”‚   â”‚   â”œâ”€â”€ IntegrationCard (components/onboarding/integration-card.tsx)
    ```

*   **State Management:**
    *   Form state (using `react-hook-form`).
    *   Loading state.
    *   Integration status (e.g., connected to Google, Stripe).
*   **Acceptance Criteria:**
    *   User can complete all onboarding steps.
    *   Integration status is correctly displayed.
    *   Settings are saved to the user's profile in Supabase.
    *   Redirects to `/scan` or `/dashboard` after completion.
*   **Edge Functions Data Contracts**: None

### 5. Scan Page `/scan`

*   **Purpose:** Initiate contact scanning process.
*   **User Flow:** User navigates to `/scan` -> Uploads business card or another source -> The scan initiates -> Contacts are processed -> Updates contact data in db.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface ScanFormValues {
      image: File;
    }

    interface ScanResponse {
      status: 'processing' | 'complete' | 'error';
      contacts?: Contact[]; // Assuming a Contact interface
      error?: string;
    }
    ```

*   **Component Hierarchy:**

    ```
    Page (app/scan/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ ScanForm
     â”‚   â”‚   â”œâ”€â”€ FileUploader
     â”‚   â”‚   â”œâ”€â”€ Button
     â”‚   â”œâ”€â”€ ScanResults
     â”‚   â”‚   â”œâ”€â”€ ContactList
    ```

*   **State Management:**
    *   Scanning state (loading, processing, complete).
    *   Scan results (list of contacts).
    *   Error state.
*   **Acceptance Criteria:**
    *   User can upload image(s).
    *   Scanning process is initiated upon submission.
    *   Scanned contacts are displayed once processing completes.
    *   Errors handled gracefully.
    *   Contacts stored in database after processing completes.
*   **Edge Functions Data Contracts**:

    *   **`process-card`**:
        *   **Input:** `File` (image of business card)
        *   **Output:**

            ```typescript
            interface ProcessCardResponse {
              status: 'success' | 'failure';
              data?: {
                name: string;
                email: string;
                phone: string;
                title: string;
                company: string;
                // ... other relevant fields
              };
              error?: string;
            }
            ```

### 6. Dashboard Page `/dashboard`

*   **Purpose:** Provide an overview of key metrics and recent activity.
*   **User Flow:** User navigates to `/dashboard` -> Views summary data, recent contacts, campaign performance.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface DashboardStats {
      totalContacts: number;
      activeCampaigns: number;
      recentActivity: ActivityItem[];
      // other metrics
    }

    interface ActivityItem {
      type: 'contact_added' | 'campaign_sent';
      timestamp: string;
      description: string;
    }
    ```

*   **Component Hierarchy:**

    ```
    Page (app/(dashboard)/dashboard/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ StatsCard (components/dashboard/stats-card.tsx)
     â”‚   â”œâ”€â”€ RecentActivity (components/dashboard/recent-activity.tsx)
     â”‚   â”œâ”€â”€ ChartContainer (components/dashboard/chart-container.tsx)
    ```

*   **State Management:**
    *   Real-time data updates using Supabase Realtime (ideally a custom hook wrapping this).
    *   Error states
*   **Acceptance Criteria:**
    *   Key metrics are displayed accurately and updated regularly.
    *   Recent activity is shown chronologically.
    *   Navigational elements to other sections of the applications.
*   **Edge Functions Data Contracts**:

    *   **`dashboard-stats`**:
        *   **Input:** `userId: string` (obtained from session)
        *   **Output:**

            ```typescript
            interface DashboardStatsResponse {
              totalContacts: number;
              activeCampaigns: number;
              leadsGenerated: number;
              // ... other stats
            }
            ```

### 7. Contact Detail Page `/contacts/[id]`

*   **Purpose:** Display detailed information about a specific contact and allow editing.
*   **User Flow:** User navigates to `/contacts/[id]` -> Views contact details -> Edits contact information -> Saves changes.

**Technical Specifications:**

*   **TypeScript Interfaces:**

```typescript
    interface Contact {
      id: string;
      firstName: string;
      lastName: string;
      email: string;
      phone: string;
      company?: string;
      jobTitle?: string;
      notes?: string;
      // ... other contact fields
    }

    interface UpdateContactRequest {
      firstName: string;
      lastName: string;
      email: string;
      phone: string;
      company?: string;
      jobTitle?: string;
      notes?: string;
      // ... other fields to be updated
}
```

*   **Component Hierarchy:**

```
    Page (app/(dashboard)/contacts/[id]/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ ContactCard (components/contacts/contact-card.tsx)
     â”‚   â”œâ”€â”€ ContactForm (components/contacts/contact-form.tsx)
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Textarea (ui/textarea.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
```

*   **State Management:**
    *   Contact data (fetched from Supabase).
    *   Form state (using `react-hook-form`).
    *   Loading state.
    *   Edit state.
*   **Acceptance Criteria:**
    *   Contact details are displayed correctly.
    *   User can edit contact information and save changes.
    *   Changes are persisted to Supabase.
    *   Real-time updates for other users viewing the same contact.
*   **Edge Functions Data Contracts**:

    *   **`contact-detail`**:
        *   **Input:** `contactId: string, userId: string` (obtained from session)
        *   **Output:**

            ```typescript
            interface ContactDetailResponse {
              id: string;
              firstName: string;
              lastName: string;
              email: string;
              phone: string;
              company?: string;
              jobTitle?: string;
              notes?: string;
              ownerId: string;
            }
            ```

### 8. Claim Page `/claim/[token]`

*   **Purpose:** Handle cases where a contact profile is being claimed
*   **User Flow:** User receives email -> Clicks link with claim token -> Profile auto-filled -> Saves new profile

**Technical Specifications:**

*   **TypeScript Interfaces:**

```typescript
interface Claim {
    claim_code: UUID
    contact_id: UUID
    contact_email: string
    user_id: UUID
    created_at: Date
    claimed_at: Date
}
interface ClaimFormValues {
  firstName: string;
  lastName: string;
  email: string;
}
```

*   **Component Hierarchy:**

```
    Page (app/claim/[token]/page.tsx)
     â”œâ”€â”€ ClaimForm (components/claim-form.tsx)
     â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”œâ”€â”€ Textarea (ui/textarea.tsx)
     â”‚   â”œâ”€â”€ Button (ui/button.tsx)
```

*   **State Management:**
    *   Claim data (fetched from Supabase).
    *   Form state (using `react-hook-form`).
    *   Loading state.
*   **Acceptance Criteria:**
    *   Form is pre-filled.
    *   Token gets invalidated after claimed.
    *   Contact relationship established between contact model and profile.
*   **Edge Functions Data Contracts**:

    *   **`claim-profile`**:
        *   **Input:** `claim_code: string`
        *   **Output:**

            ```typescript
interface ClaimProfileResponse {
    claim_code: UUID
    contact_id: UUID
    contact_email: string
    user_id: UUID
    created_at: Date
    claimed_at: Date
}
            ```
### 9. Settings Page `/settings`

*   **Purpose:** Allow users to manage their account preferences, integrations, and subscription.
*   **User Flow:** User navigates to `/settings` -> Updates profile information, connects/disconnects integrations, manages subscription.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface SettingsFormValues {
      fullName: string;
      email: string;
      // Add new settings here
    }
    ```

*   **Component Hierarchy:**

    ```
    Page (app/(dashboard)/settings/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ ProfileSettings (components/settings/profile-settings.tsx)  #SettingsForm lives here
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
     â”‚   â”œâ”€â”€ IntegrationSettings (components/settings/integration-settings.tsx)
     â”‚   â”œâ”€â”€ SubscriptionSettings (components/settings/subscription-settings.tsx)
    ```

*   **State Management:**
    *   Settings data (fetched from Supabase).
    *   Form state (using `react-hook-form`).
    *   Loading state.
*   **Acceptance Criteria:**
    *   Settings are displayed correctly.
    *   User can update profile information and save changes.
    *   Integration status are correctly tracked.
    *   Actions like "Disconnect" or "Change Plan" work according to design
*   **Edge Functions Data Contracts**:
    *   **`update-profile`**:
        *   **Input:** `userId: string`, `SettingsFormValues` (obtained from form).
        *   **Output:**

            ```typescript
            interface UpdateProfileResponse {
              success: boolean;
              message?: string;
            }
            ```

### 10. Pricing Page `/pricing`

*   **Purpose:** Display available pricing plans and allow users to subscribe.
*   **User Flow:** User navigates to `/pricing` -> Views plans -> Selects plan -> Redirected to Stripe checkout.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface PricingPlan {
      id: string;
      name: string;
      price: number;
      features: string[];
    }
    ```

*   **Component Hierarchy:**

    ```
    Page (app/(marketing)/pricing/page.tsx)
     â”œâ”€â”€ (marketing)/layout.tsx
     â”‚   â”œâ”€â”€ PricingCard (components/pricing/pricing-card.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
    ```

*   **State Management:**
    *   None.
*   **Acceptance Criteria:**
    *   Pricing plans are displayed correctly.
    *   User

## requirements-analyst
Okay, I will enhance the provided technical specifications for the 10 pages of OpenContact.ai, detailing data contracts for the listed Edge Functions and augmenting existing sections with relevant information.

## OpenContact.ai Page Technical Specifications (Revised)

**Assumptions:**

*   The project utilizes TypeScript, React, Next.js 14 (App Router), and Tailwind CSS as outlined in the architecture document.
*   Supabase is used for authentication and data persistence.
*   `shadcn/ui` components are available for UI elements.
*   Zod is used for form validation.
*   "@opencontact/shared" & "@opencontact/ui" monorepo packages are available.

### 1. Landing Page `/`

*   **Purpose:** Public-facing marketing page to introduce OpenContact.ai and its features.
*   **User Flow:** User visits the page -> Reads content -> Clicks "Sign Up" or "Login" CTA.

**Technical Specifications:**

*   **TypeScript Interfaces:**
    *   None (static content, no API calls).
*   **Component Hierarchy:**
    ```
    Page (app/page.tsx)
     â”œâ”€â”€ (marketing)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ Header (components/layout/header.tsx)
     â”‚   â”œâ”€â”€ HeroSection
     â”‚   â”œâ”€â”€ FeaturesSection
     â”‚   â”œâ”€â”€ TestimonialsSection
     â”‚   â”œâ”€â”€ PricingPreviewSection
     â”‚   â””â”€â”€ Footer (components/layout/footer.tsx)
    ```
*   **State Management:** None.
*   **Acceptance Criteria:**
    *   Visually appealing and responsive design.
    *   Clear and concise presentation of OpenContact.ai's value proposition.
    *   CTAs link correctly to signup and login pages.
    *   SEO metadata is correctly configured.
*   **Edge Functions Data Contracts**: None

### 2. Login Page `/login`

*   **Purpose:** Allow existing users to authenticate.
*   **User Flow:** User navigates to `/login` -> Enters credentials -> Clicks "Login" -> Redirects to dashboard (`/dashboard`) on success or displays error on failure.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    // Request (Credential-based; could extend for OAuth)
    interface LoginFormValues {
      email: string;
      password?: string;
    }

    //This leverages Supabase's auth response and types.
    type AuthResponse =
      | {
          data: {
            session: Session | null;
            user: User | null;
          };
          error: null;
        }
      | {
          data: {
            session: null;
            user: null;
          };
          error: AuthError;
        };
    ```
*   **Security Considerations**
    *  Rate limit attempts login to prevent brute-force attacks.
    *  Implement CSRF protection.

*   **Component Hierarchy:**

    ```
    Page (app/(auth)/login/page.tsx)
     â”œâ”€â”€ (auth)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ LoginForm (components/auth/login-form.tsx)
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
     â”‚   â”‚   â””â”€â”€ Link (next/link)
    ```

*   **State Management:**
    *   Form state (using `react-hook-form`)
    *   Loading state
    *   Error state (for displaying login errors).
*   **Acceptance Criteria:**
    *   Form validation with appropriate error messages.
    *   Successful login redirects to `/dashboard`.
    *   Error messages are displayed for invalid credentials or server errors.
    *   "Forgot Password" link is present and functional.
    *   OAuth Login option.
*   **Edge Functions Data Contracts**: None

### 3. Signup Page `/signup`

*   **Purpose:** Allow new users to create an account.
*   **User Flow:** User navigates to `/signup` -> Enters required information -> Clicks "Sign Up" -> Account created; redirected to `/onboarding` or displays error messages.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface SignupFormValues {
      email: string;
      password?: string;
    }
    //This leverages Supabase's auth response and types.
    type AuthResponse =
      | {
          data: {
            session: Session | null;
            user: User | null;
          };
          error: null;
        }
      | {
          data: {
            session: null;
            user: null;
          };
          error: AuthError;
        };
    ```

*   **Component Hierarchy:**

    ```
    Page (app/(auth)/signup/page.tsx)
     â”œâ”€â”€ (auth)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ SignupForm (components/auth/signup-form.tsx)
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
     â”‚   â”‚   â””â”€â”€ Link (next/link)
    ```

*   **State Management:**
    *   Form state (using `react-hook-form`).
    *   Loading state.
    *   Error state.
*   **Acceptance Criteria:**
    *   Form validation with appropriate error messages.
    *   Successful signup creates a new user in Supabase Auth and redirects to `/onboarding`.
    *   Error messages are displayed for invalid input or server errors (e.g., email already exists).
*   **Edge Functions Data Contracts**: None

### 4. Onboarding Page `/onboarding`

*   **Purpose:** Guide new users through initial setup and configuration.
*   **User Flow:** User completes onboarding steps -> Integrates services, sets preferences, etc. -> Redirects to `/scan` or `/dashboard`.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface OnboardingFormValues {
      fullName: string;
      companyName?: string;
      //other settings/preferences
    }

    interface IntegrationStatus {
      service: 'google' | 'stripe' | 'other';
      isConnected: boolean;
    }

    interface UpdateUserMetadataRequest {
        fullName: string;
        companyName?: string;
        //... other profile fields
    }

    interface UpdateUserMetadataResponse {
        success: boolean;
        error?: string;
    }

    ```

*   **Component Hierarchy:**

    ```
    Page (app/onboarding/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout - since it's a protected route)
     â”‚   â”œâ”€â”€ OnboardingForm
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Select (ui/select.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
     â”‚   â”‚   â”œâ”€â”€ IntegrationCard (components/onboarding/integration-card.tsx)
    ```

*   **State Management:**
    *   Form state (using `react-hook-form`).
    *   Loading state.
    *   Integration status (e.g., connected to Google, Stripe).
*   **Acceptance Criteria:**
    *   User can complete all onboarding steps.
    *   Integration status is correctly displayed.
    *   Settings are saved to the user's profile in Supabase.
    *   Redirects to `/scan` or `/dashboard` after completion.
*   **Edge Functions Data Contracts**: None

### 5. Scan Page `/scan`

*   **Purpose:** Initiate contact scanning process.
*   **User Flow:** User navigates to `/scan` -> Uploads business card or another source -> The scan initiates -> Contacts are processed -> Updates contact data in db.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface ScanFormValues {
      image: File;
    }

    interface ScanResponse {
      status: 'processing' | 'complete' | 'error';
      contacts?: Contact[]; // Assuming a Contact interface
      error?: string;
    }
    ```

*   **Component Hierarchy:**

    ```
    Page (app/scan/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ ScanForm
     â”‚   â”‚   â”œâ”€â”€ FileUploader
     â”‚   â”‚   â”œâ”€â”€ Button
     â”‚   â”œâ”€â”€ ScanResults
     â”‚   â”‚   â”œâ”€â”€ ContactList
    ```

*   **State Management:**
    *   Scanning state (loading, processing, complete).
    *   Scan results (list of contacts).
    *   Error state.
*   **Acceptance Criteria:**
    *   User can upload image(s).
    *   Scanning process is initiated upon submission.
    *   Scanned contacts are displayed once processing completes.
    *   Errors handled gracefully.
    *   Contacts stored in database after processing completes.
*   **Edge Functions Data Contracts**:

    *   **`process-card`**:
        *   **Input:** `File` (image of business card)
        *   **Output:**

            ```typescript
            interface ProcessCardResponse {
              status: 'success' | 'failure';
              data?: {
                name: string;
                email: string;
                phone: string;
                title: string;
                company: string;
                //... other relevant fields
              };
              error?: string;
            }
            ```

### 6. Dashboard Page `/dashboard`

*   **Purpose:** Provide an overview of key metrics and recent activity.
*   **User Flow:** User navigates to `/dashboard` -> Views summary data, recent contacts, campaign performance.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface DashboardStats {
      totalContacts: number;
      activeCampaigns: number;
      recentActivity: ActivityItem[];
      //... other metrics
    }

    interface ActivityItem {
      type: 'contact_added' | 'campaign_sent';
      timestamp: string;
      description: string;
    }
    ```

*   **Component Hierarchy:**

    ```
    Page (app/(dashboard)/dashboard/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ StatsCard (components/dashboard/stats-card.tsx)
     â”‚   â”œâ”€â”€ RecentActivity (components/dashboard/recent-activity.tsx)
     â”‚   â”œâ”€â”€ ChartContainer (components/dashboard/chart-container.tsx)
    ```

*   **State Management:**
    *   Real-time data updates using Supabase Realtime (ideally a custom hook wrapping this). This includes:
        *   Total Contacts
        *   Active Campaigns
    *   Error states
*   **Acceptance Criteria:**
    *   Key metrics are displayed accurately and updated regularly.
    *   Recent activity is shown chronologically.
    *   Navigational elements to other sections of the applications.
*   **Edge Functions Data Contracts**:

    *   **`dashboard-stats`**:
        *   **Input:** `userId: string` (obtained from session)
        *   **Output:**

            ```typescript
            interface DashboardStatsResponse {
              totalContacts: number;
              activeCampaigns: number;
              leadsGenerated: number;
              //... other stats
            }
            ```

### 7. Contact Detail Page `/contacts/[id]`

*   **Purpose:** Display detailed information about a specific contact and allow editing.
*   **User Flow:** User navigates to `/contacts/[id]` -> Views contact details -> Edits contact information -> Saves changes.

**Technical Specifications:**

*   **TypeScript Interfaces:**

```typescript
    interface Contact {
      id: string;
      firstName: string;
      lastName: string;
      email: string;
      phone: string;
      company?: string;
      jobTitle?: string;
      notes?: string;
      //... other contact fields
    }

    interface UpdateContactRequest {
      firstName: string;
      lastName: string;
      email: string;
      phone: string;
      company?: string;
      jobTitle?: string;
      notes?: string;
      //... other fields to be updated
}
```

*   **Component Hierarchy:**

```
    Page (app/(dashboard)/contacts/[id]/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ ContactCard (components/contacts/contact-card.tsx)
     â”‚   â”œâ”€â”€ ContactForm (components/contacts/contact-form.tsx)
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Textarea (ui/textarea.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
```

*   **State Management:**
    *   Contact data (fetched from Supabase).
    *   Form state (using `react-hook-form`).
    *   Loading state.
    *   Edit state.
*   **Acceptance Criteria:**
    *   Contact details are displayed correctly.
    *   User can edit contact information and save changes.
    *   Changes are persisted to Supabase.
    *   Real-time updates for other users viewing the same contact.
*   **Edge Functions Data Contracts**:

    *   **`contact-detail`**:
        *   **Input:** `contactId: string, userId: string` (obtained from session)
        *   **Output:**

            ```typescript
            interface ContactDetailResponse {
              id: string;
              firstName: string;
              lastName: string;
              email: string;
              phone: string;
              company?: string;
              jobTitle?: string;
              notes?: string;
              ownerId: string;
            }
            ```
    *   **`contacts-list`**: (*Implicitly called to refresh main Contacts view*)
        *   **Input**: `userId: string`
        *   **Output**:

            ```typescript
            interface ContactListResponse {
                contacts: ContactDetailResponse[];
                totalCount: number;
            }
            ```

### 8. Claim Page `/claim/[token]`

*   **Purpose:** Handle cases where a contact profile is being claimed
*   **User Flow:** User receives email -> Clicks link with claim token -> Profile auto-filled -> Saves new profile

**Technical Specifications:**

*   **TypeScript Interfaces:**

```typescript
interface Claim {
    claim_code: UUID
    contact_id: UUID
    contact_email: string
    user_id: UUID
    created_at: Date
    claimed_at: Date
}
interface ClaimFormValues {
  firstName: string;
  lastName: string;
  email: string;
}
```

*   **Component Hierarchy:**

```
    Page (app/claim/[token]/page.tsx)
     â”œâ”€â”€ ClaimForm (components/claim-form.tsx)
     â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”œâ”€â”€ Textarea (ui/textarea.tsx)
     â”‚   â”œâ”€â”€ Button (ui/button.tsx)
```

*   **State Management:**
    *   Claim data (fetched from Supabase).
    *   Form state (using `react-hook-form`).
    *   Loading state.
*   **Acceptance Criteria:**
    *   Form is pre-filled.
    *   Token gets invalidated after claimed.
    *   Contact relationship established between contact model and profile.
*   **Edge Functions Data Contracts**:

    *   **`claim-profile`**:
        *   **Input:** `claim_code: string`
        *   **Output:**

            ```typescript
interface ClaimProfileResponse {
    claim_code: UUID
    contact_id: UUID
    contact_email: string
    user_id: UUID
    created_at: Date
    claimed_at: Date
}
            ```

### 9. Settings Page `/settings`

*   **Purpose:** Allow users to manage their account preferences, integrations, and subscription.
*   **User Flow:** User navigates to `/settings` -> Updates profile information, connects/disconnects integrations, manages subscription.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface SettingsFormValues {
      fullName: string;
      email: string;
      //Add new settings here
    }
    ```

*   **Component Hierarchy:**

    ```
    Page (app/(dashboard)/settings/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ ProfileSettings (components/settings/profile-settings.tsx)  #SettingsForm lives here
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
     â”‚   â”œâ”€â”€ IntegrationSettings (components/settings/integration-settings.tsx)
     â”‚   â”œâ”€â”€ SubscriptionSettings (components/settings/subscription-settings.tsx)
    ```

*   **State Management:**
    *   Settings data (fetched from Supabase).
    *   Form state (using `react-hook-form`).
    *   Loading state.
*   **Acceptance Criteria:**
    *   Settings are displayed correctly.
    *   User can update profile information and save changes.
    *   Integration status integration settings section are correctly tracked.
    *   Actions like "Disconnect" in the IntegrationsSetting, or "Change Plan" in SubscriptionSetting, buttons work according to design
*   **Edge Functions Data Contracts**:
    *   **`update-profile`**:
        *   **Input:** `userId: string`, `SettingsFormValues` (obtained from form).
        *   **Output:**

            ```typescript
            interface UpdateProfileResponse {
              success: boolean;
              message?: string;
            }
            ```

### 10. Pricing Page `/pricing`

*   **Purpose:** Display available pricing plans and allow users to subscribe.
*   **User Flow:** User navigates to `/pricing` -> Views plans -> Selects plan -> Redirected to Stripe checkout.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface PricingPlan {
      id: string;
      name: string;


## core-builder
I'll build the foundational OpenContact.ai codebase with all the required components. Note: Based on the research findings, I'll use `@supabase/ssr` (the recommended package) instead of the deprecated `@supabase/auth-helpers-nextjs`.

```json
{
  "name": "opencontact-ai",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "turbo dev --filter=web",
    "build": "turbo build --filter=web",
    "lint": "turbo lint --filter=web",
    "type-check": "turbo type-check --filter=web",
    "db:types": "supabase gen types typescript --project-id $SUPABASE_PROJECT_ID > apps/web/src/types/database.ts"
  },
  "devDependencies": {
    "turbo": "^2.3.0",
    "typescript": "^5.6.3"
  },
  "packageManager": "pnpm@9.12.2",
  "pnpm": {
    "overrides": {
      "react": "^18.3.1",
      "react-dom": "^18.3.1"
    }
  }
}
```

---

```json
{
  "name": "@opencontact/web",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev --turbo",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "type-check": "tsc --noEmit"
  },
  "dependencies": {
    "@anthropic-ai/sdk": "^0.30.1",
    "@hookform/resolvers": "^3.9.1",
    "@radix-ui/react-avatar": "^1.1.2",
    "@radix-ui/react-dialog": "^1.1.4",
    "@radix-ui/react-dropdown-menu": "^2.1.4",
    "@radix-ui/react-label": "^2.1.1",
    "@radix-ui/react-select": "^2.1.4",
    "@radix-ui/react-separator": "^1.1.1",
    "@radix-ui/react-slot": "^1.1.1",
    "@radix-ui/react-toast": "^1.2.4",
    "@radix-ui/react-tooltip": "^1.1.6",
    "@supabase/ssr": "^0.5.2",
    "@supabase/supabase-js": "^2.47.10",
    "@tanstack/react-query": "^5.62.7",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "date-fns": "^4.1.0",
    "framer-motion": "^11.15.0",
    "lucide-react": "^0.468.0",
    "next": "^14.2.18",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-hook-form": "^7.54.0",
    "sonner": "^1.7.1",
    "stripe": "^17.4.0",
    "tailwind-merge": "^2.6.0",
    "tailwindcss-animate": "^1.0.7",
    "zod": "^3.24.1",
    "zustand": "^5.0.2"
  },
  "devDependencies": {
    "@types/node": "^22.10.1",
    "@types/react": "^18.3.16",
    "@types/react-dom": "^18.3.5",
    "autoprefixer": "^10.4.20",
    "eslint": "^9.16.0",
    "eslint-config-next": "^14.2.18",
    "postcss": "^8.4.49",
    "prettier": "^3.4.2",
    "prettier-plugin-tailwindcss": "^0.6.9",
    "tailwindcss": "^3.4.17",
    "typescript": "^5.6.3"
  }
}
```

---

```javascript
/** @type {import('tailwindcss').Config} */
module.exports = {
  darkMode: ["class"],
  content: [
    "./src/pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/components/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/app/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      colors: {
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "#2563EB", // blue-600
          foreground: "#FFFFFF",
          50: "#EFF6FF",
          100: "#DBEAFE",
          200: "#BFDBFE",
          300: "#93C5FD",
          400: "#60A5FA",
          500: "#3B82F6",
          600: "#2563EB", // Brand primary
          700: "#1D4ED8",
          800: "#1E40AF",
          900: "#1E3A8A",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "#F59E0B", // amber-500
          foreground: "hsl(var(--accent-foreground))",
          50: "#FFFBEB",
          100: "#FEF3C7",
          200: "#FDE68A",
          300: "#FCD34D",
          400: "#FBBF24",
          500: "#F59E0B", // Brand accent
          600: "#D97706",
          700: "#B45309",
          800: "#92400E",
          900: "#78350F",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
        slate: {
          850: "#1E293B", // Custom dark shade
          900: "#0F172A", // dark slate-900 background
          950: "#020617",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      keyframes: {
        "accordion-down": {
          from: { height: "0" },
          to: { height: "var(--radix-accordion-content-height)" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)" },
          to: { height: "0" },
        },
        "fade-in": {
          from: { opacity: "0" },
          to: { opacity: "1" },
        },
        "slide-in-from-top": {
          from: { transform: "translateY(-100%)" },
          to: { transform: "translateY(0)" },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
        "fade-in": "fade-in 0.3s ease-out",
        "slide-in-from-top": "slide-in-from-top 0.3s ease-out",
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
}
```

---

```typescript
import type { Config } from "tailwindcss";

const config: Config = {
  darkMode: ["class"],
  content: [
    "./src/pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/components/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/app/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      colors: {
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "#2563EB", // blue-600
          foreground: "#FFFFFF",
          50: "#EFF6FF",
          100: "#DBEAFE",
          200: "#BFDBFE",
          300: "#93C5FD",
          400: "#60A5FA",
          500: "#3B82F6",
          600: "#2563EB", // Brand primary
          700: "#1D4ED8",
          800: "#1E40AF",
          900: "#1E3A8A",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "#F59E0B", // amber-500
          foreground: "hsl(var(--accent-foreground))",
          50: "#FFFBEB",
          100: "#FEF3C7",
          200: "#FDE68A",
          300: "#FCD34D",
          400: "#FBBF24",
          500: "#F59E0B", // Brand accent
          600: "#D97706",
          700: "#B45309",
          800: "#92400E",
          900: "#78350F",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
        slate: {
          850: "#1E293B",
          900: "#0F172A", // dark slate-900 background
          950: "#020617",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      keyframes: {
        "accordion-down": {
          from: { height: "0" },
          to: { height: "var(--radix-accordion-content-height)" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)" },
          to: { height: "0" },
        },
        "fade-in": {
          from: { opacity: "0" },
          to: { opacity: "1" },
        },
        "slide-in-from-top": {
          from: { transform: "translateY(-100%)" },
          to: { transform: "translateY(0)" },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
        "fade-in": "fade-in 0.3s ease-out",
        "slide-in-from-top": "slide-in-from-top 0.3s ease-out",
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
};

export default config;
```

---

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 6.5%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;
    --primary: 217.2 91.2% 59.8%;
    --primary-foreground: 222.2 47.4% 11.2%;
    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 38 92% 50%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 224.3 76.3% 48%;
    --radius: 0.5rem;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-slate-900 text-foreground;
    font-feature-settings: "rlig" 1, "calt" 1;
  }
}

/* Custom scrollbar for dark theme */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: hsl(var(--muted));
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: hsl(var(--muted-foreground) / 0.3);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: hsl(var(--muted-foreground) / 0.5);
}

/* Animation utilities */
@utility animate-in {
  animation: fade-in 0.3s ease-out;
}
```

---

```typescript
import { createBrowserClient } from '@supabase/ssr';
import type { Database } from '@/types/database';

let client: ReturnType<typeof createBrowserClient<Database>> | undefined;

/**
 * Browser-side Supabase client (singleton pattern)
 * Use in Client Components, API routes, and other client-side contexts
 */
export function getSupabaseBrowserClient() {
  if (client) {
    return client;
  }

  client = createBrowserClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );

  return client;
}
```

---

```typescript
import { createServerClient } from '@supabase/ssr';
import { cookies } from 'next/headers';
import type { Database } from '@/types/database';

/**
 * Server-side Supabase client for Server Components
 * Uses getAll/setAll cookie pattern (REQUIRED for @supabase/ssr)
 */
export async function getSupabaseServerClient() {
  const cookieStore = await cookies();

  return createServerClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll();
        },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) => {
              cookieStore.set(name, value, options);
            });
          } catch {
            // This can fail in Server Components during initial render
            // The error is safely ignored as cookies are set in middleware
          }
        },
      },
    }
  );
}
```

---

```typescript
import { createServerClient } from '@supabase/ssr';
import { NextResponse, type NextRequest } from 'next/server';
import type { Database } from '@/types/database';

/**
 * Supabase client for Next.js Middleware
 * Handles auth token refresh and request

## pages-builder
I'll build all 10 pages with production-grade code. Let me start by creating the foundational files and then implement each page.

```typescript
// apps/web/src/types/database.ts
// Auto-generated by Supabase
export type Json =
  | string
  | number
  | boolean
  | null
  | { [key: string]: Json | undefined }
  | Json[]

export interface Database {
  public: {
    Tables: {
      profiles: {
        Row: {
          id: string
          email: string
          full_name: string | null
          company_name: string | null
          job_title: string | null
          phone: string | null
          twilio_number: string | null
          sender_email: string | null
          avatar_url: string | null
          created_at: string
          updated_at: string
        }
        Insert: {
          id: string
          email: string
          full_name?: string | null
          company_name?: string | null
          job_title?: string | null
          phone?: string | null
          twilio_number?: string | null
          sender_email?: string | null
          avatar_url?: string | null
          created_at?: string
          updated_at?: string
        }
        Update: {
          id?: string
          email?: string
          full_name?: string | null
          company_name?: string | null
          job_title?: string | null
          phone?: string | null
          twilio_number?: string | null
          sender_email?: string | null
          avatar_url?: string | null
          created_at?: string
          updated_at?: string
        }
      }
      contacts: {
        Row: {
          id: string
          user_id: string
          first_name: string
          last_name: string
          email: string
          phone: string
          company: string | null
          job_title: string | null
          notes: string | null
          source: string | null
          status: string
          claimed: boolean
          created_at: string
          updated_at: string
        }
        Insert: {
          id?: string
          user_id: string
          first_name: string
          last_name: string
          email: string
          phone: string
          company?: string | null
          job_title?: string | null
          notes?: string | null
          source?: string | null
          status?: string
          claimed?: boolean
          created_at?: string
          updated_at?: string
        }
        Update: {
          id?: string
          user_id?: string
          first_name?: string
          last_name?: string
          email?: string
          phone?: string
          company?: string | null
          job_title?: string | null
          notes?: string | null
          source?: string | null
          status?: string
          claimed?: boolean
          created_at?: string
          updated_at?: string
        }
      }
      conversations: {
        Row: {
          id: string
          contact_id: string
          user_id: string
          direction: 'inbound' | 'outbound'
          channel: 'sms' | 'email'
          content: string
          twilio_sid: string | null
          status: 'pending' | 'sent' | 'delivered' | 'failed'
          created_at: string
        }
        Insert: {
          id?: string
          contact_id: string
          user_id: string
          direction: 'inbound' | 'outbound'
          channel: 'sms' | 'email'
          content: string
          twilio_sid?: string | null
          status?: 'pending' | 'sent' | 'delivered' | 'failed'
          created_at?: string
        }
        Update: {
          id?: string
          contact_id?: string
          user_id?: string
          direction?: 'inbound' | 'outbound'
          channel?: 'sms' | 'email'
          content?: string
          twilio_sid?: string | null
          status?: 'pending' | 'sent' | 'delivered' | 'failed'
          created_at?: string
        }
      }
      claims: {
        Row: {
          id: string
          claim_code: string
          contact_id: string
          user_id: string | null
          claimed_at: string | null
          created_at: string
        }
        Insert: {
          id?: string
          claim_code: string
          contact_id: string
          user_id?: string | null
          claimed_at?: string | null
          created_at?: string
        }
        Update: {
          id?: string
          claim_code?: string
          contact_id?: string
          user_id?: string | null
          claimed_at?: string | null
          created_at?: string
        }
      }
    }
  }
}

export type Profile = Database['public']['Tables']['profiles']['Row']
export type Contact = Database['public']['Tables']['contacts']['Row']
export type Conversation = Database['public']['Tables']['conversations']['Row']
export type Claim = Database['public']['Tables']['claims']['Row']
```

```typescript
// apps/web/src/lib/utils/cn.ts
import { type ClassValue, clsx } from 'clsx'
import { twMerge } from 'tailwind-merge'

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
```

```typescript
// apps/web/src/lib/utils/formatters.ts
import { format, formatDistanceToNow } from 'date-fns'

export function formatDate(date: string | Date): string {
  return format(new Date(date), 'MMM d, yyyy')
}

export function formatDateTime(date: string | Date): string {
  return format(new Date(date), 'MMM d, yyyy h:mm a')
}

export function formatRelativeTime(date: string | Date): string {
  return formatDistanceToNow(new Date(date), { addSuffix: true })
}

export function formatPhoneNumber(phone: string): string {
  const cleaned = phone.replace(/\D/g, '')
  if (cleaned.length === 10) {
    return `(${cleaned.slice(0, 3)}) ${cleaned.slice(3, 6)}-${cleaned.slice(6)}`
  }
  if (cleaned.length === 11 && cleaned[0] === '1') {
    return `+1 (${cleaned.slice(1, 4)}) ${cleaned.slice(4, 7)}-${cleaned.slice(7)}`
  }
  return phone
}

export function formatInitials(name: string): string {
  return name
    .split(' ')
    .map((n) => n[0])
    .join('')
    .toUpperCase()
    .slice(0, 2)
}
```

```typescript
// apps/web/src/app/globals.css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 6.5%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;
    --primary: 217.2 91.2% 59.8%;
    --primary-foreground: 222.2 47.4% 11.2%;
    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 38 92% 50%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 224.3 76.3% 48%;
    --radius: 0.5rem;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-slate-900 text-foreground;
    font-feature-settings: "rlig" 1, "calt" 1;
  }
}

::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: hsl(var(--muted));
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: hsl(var(--muted-foreground) / 0.3);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: hsl(var(--muted-foreground) / 0.5);
}

@utility animate-in {
  animation: fade-in 0.3s ease-out;
}
```

```typescript
// apps/web/src/components/ui/button.tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils/cn"

const buttonVariants = cva(
  "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive: "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline: "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary: "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }
```

```typescript
// apps/web/src/components/ui/input.tsx
import * as React from "react"
import { cn } from "@/lib/utils/cn"

export interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {}

const Input = React.forwardRef<HTMLInputElement, InputProps>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }
```

```typescript
// apps/web/src/components/ui/card.tsx
import * as React from "react"
import { cn } from "@/lib/utils/cn"

const Card = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div
      ref={ref}
      className={cn("rounded-lg border bg-card text-card-foreground shadow-sm", className)}
      {...props}
    />
  )
)
Card.displayName = "Card"

const CardHeader = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("flex flex-col space-y-1.5 p-6", className)} {...props} />
  )
)
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLHeadingElement>>(
  ({ className, ...props }, ref) => (
    <h3
      ref={ref}
      className={cn("text-2xl font-semibold leading-none tracking-tight", className)}
      {...props}
    />
  )
)
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(
  ({ className, ...props }, ref) => (
    <p ref={ref} className={cn("text-sm text-muted-foreground", className)} {...props} />
  )
)
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
  )
)
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("flex items-center p-6 pt-0", className)} {...props} />
  )
)
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }
```

```typescript
// apps/web/src/components/ui/label.tsx
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils/cn"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> & VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root ref={ref} className={cn(labelVariants(), className)} {...props} />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }
```

```typescript
// apps/web/src/components/ui/textarea.tsx
import * as React from "react"
import { cn } from "@/lib/utils/cn"

export interface TextareaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}

const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ className, ...props }, ref) => {
    return (
      <textarea
        className={cn(
          "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Textarea.displayName = "Textarea"

export { Textarea }
```

```typescript
// apps/web/src/components/ui/avatar.tsx
"use client"

import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"
import { cn } from "@/lib/utils/cn"

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full", className)}
    {...props}
  />
))
Avatar.displayName = AvatarPrimitive.Root.displayName

const
Final merged output

## architecture-scout
# OpenContact.ai Frontend Architecture Plan

## Executive Summary

Based on analysis of Supabase documentation, Next.js 14 App Router patterns, and multi-tenant architecture best practices, here's a comprehensive scaffold plan for OpenContact.ai.

---

## 1. Complete Folder Structure (Monorepo)

```
opencontact-ai/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/                          # Main Next.js 14 application
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ app/                  # Next.js App Router
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ (auth)/           # Auth route group
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ signup/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ callback/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ (dashboard)/      # Protected dashboard routes
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contacts/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ conversations/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ (marketing)/      # Public marketing pages
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx      # Landing page
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ pricing/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ api/              # API routes (Edge Functions)
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ webhooks/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ stripe/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ trpc/
â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ [trpc]/
â”‚   â”‚   â”‚   â”‚   â”‚           â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx        # Root layout
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ not-found.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ui/               # shadcn/ui components
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login-form.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ signup-form.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ auth-provider.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contacts/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contact-list.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contact-card.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ contact-form.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ conversations/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ chat-window.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ message-list.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ message-input.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sidebar.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ header.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ mobile-nav.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ shared/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ loading.tsx
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ error-boundary.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ contexts/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ auth-context.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ use-auth.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ use-contacts.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ use-conversations.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ use-realtime.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ browser-client.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ server-client.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ middleware-client.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ utils.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ constants.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ server/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ actions/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contacts.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ conversations.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contacts.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ conversations.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ queries/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ database.ts        # Supabase generated types
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”‚   â””â”€â”€ middleware.ts
â”‚   â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”‚   â”œâ”€â”€ favicon/
â”‚   â”‚   â”‚   â””â”€â”€ og-image.png
â”‚   â”‚   â”œâ”€â”€ next.config.js
â”‚   â”‚   â”œâ”€â”€ tailwind.config.ts
â”‚   â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ docs/                         # Documentation app (optional)
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ db/                           # Shared database package
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â””â”€â”€ migrations/
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ ui/                           # Shared UI components
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ utils/                        # Shared utilities
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â””â”€â”€ index.ts
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ functions/
â”‚   â”‚   â”œâ”€â”€ ai-reply/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ send-notification/
â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ config.toml
â”‚   â””â”€â”€ seed.sql
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json                      # Root package.json (workspaces)
â”œâ”€â”€ turbo.json                        # Turborepo config
â”œâ”€â”€ pnpm-workspace.yaml
â””â”€â”€ README.md
```

---

## 2. Environment Variables Template

```bash
# ============================================
# OpenContact.ai Environment Configuration
# ============================================

# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# New publishable key (recommended)
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY=sb_publishable_xxx

# Database Direct Connection (for migrations)
DATABASE_URL=postgresql://postgres:password@db.your-project.supabase.co:5432/postgres

# App Configuration
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_APP_NAME=OpenContact.ai

# Stripe Configuration
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_xxx
STRIPE_SECRET_KEY=sk_test_xxx
STRIPE_WEBHOOK_SECRET=whsec_xxx

# AI Provider Keys
OPENAI_API_KEY=sk-xxx
ANTHROPIC_API_KEY=sk-ant-xxx

# Email Configuration (Resend)
RESEND_API_KEY=re_xxx
EMAIL_FROM=noreply@opencontact.ai

# Push Notifications (optional)
VAPID_PUBLIC_KEY=xxx
VAPID_PRIVATE_KEY=xxx

# Feature Flags
NEXT_PUBLIC_ENABLE_AI_FEATURES=true
NEXT_PUBLIC_ENABLE_REALTIME=true

# Analytics (optional)
NEXT_PUBLIC_POSTHOG_KEY=phc_xxx
NEXT_PUBLIC_GA_ID=G-xxx

# Development
NODE_ENV=development
```

---

## 3. Package Dependencies

### Root `package.json` (Turborepo)

```json
{
  "name": "opencontact-ai",
  "private": true,
  "scripts": {
    "dev": "turbo dev",
    "build": "turbo build",
    "lint": "turbo lint",
    "type-check": "turbo type-check",
    "db:generate": "turbo db:generate",
    "db:push": "turbo db:push",
    "db:migrate": "supabase migration up"
  },
  "devDependencies": {
    "turbo": "^2.0.0",
    "typescript": "^5.3.0"
  },
  "packageManager": "pnpm@8.15.0"
}
```

### Main App `package.json`

```json
{
  "name": "@opencontact/web",
  "version": "0.1.0",
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "type-check": "tsc --noEmit"
  },
  "dependencies": {
    "next": "^14.2.0",
    "react": "^18.3.0",
    "react-dom": "^18.3.0",
    
    "@supabase/supabase-js": "^2.39.0",
    "@supabase/ssr": "^0.1.0",
    "@supabase/auth-helpers-nextjs": "^0.9.0",
    
    "@tanstack/react-query": "^5.28.0",
    "@trpc/client": "^11.0.0",
    "@trpc/server": "^11.0.0",
    "@trpc/react-query": "^11.0.0",
    "@trpc/next": "^11.0.0",
    
    "zod": "^3.22.0",
    "react-hook-form": "^7.51.0",
    "@hookform/resolvers": "^3.3.0",
    
    "framer-motion": "^11.0.0",
    "date-fns": "^3.6.0",
    "lucide-react": "^0.356.0",
    
    "tailwindcss": "^3.4.0",
    "@radix-ui/react-slot": "^1.0.2",
    "class-variance-authority": "^0.7.0",
    "clsx": "^2.1.0",
    "tailwind-merge": "^2.2.0",
    
    "stripe": "^14.20.0",
    "openai": "^4.28.0",
    "@anthropic-ai/sdk": "^0.24.0",
    
    "react-hot-toast": "^2.4.1",
    "zustand": "^4.5.0"
  },
  "devDependencies": {
    "@types/node": "^20.11.0",
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "typescript": "^5.3.0",
    "eslint": "^8.57.0",
    "eslint-config-next": "^14.2.0",
    "prettier": "^3.2.0",
    "prettier-plugin-tailwindcss": "^0.5.0"
  }
}
```

---

## 4. Supabase Client Initialization Pattern

Based on [supabase.com](https://supabase.com/docs/guides/auth/quickstarts/nextjs) and [makerkit.dev](https://makerkit.dev/courses/nextjs-app-router/authentication), the SSR package is the modern approach:

### Browser Client (`src/lib/supabase/browser-client.ts`)

```typescript
import { createBrowserClient } from '@supabase/ssr';
import { Database } from '@/types/database';

let client: ReturnType<typeof createBrowserClient<Database>> | undefined;

export function getSupabaseBrowserClient() {
  if (client) {
    return client;
  }

  client = createBrowserClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );

  return client;
}
```

### Server Client (`src/lib/supabase/server-client.ts`)

```typescript
import { createServerClient } from '@supabase/ssr';
import { cookies } from 'next/headers';
import { Database } from '@/types/database';

export async function getSupabaseServerClient() {
  const cookieStore = await cookies();

  return createServerClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll();
        },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options)
            );
          } catch {
            // Handle cookie errors in middleware
          }
        },
      },
    }
  );
}
```

### Middleware Client (`src/lib/supabase/middleware-client.ts`)

```typescript
import { createServerClient } from '@supabase/ssr';
import { NextResponse, type NextRequest } from 'next/server';
import { Database } from '@/types/database';

export function getSupabaseMiddlewareClient(request: NextRequest) {
  let response = NextResponse.next({
    request: {
      headers: request.headers,
    },
  });

  const supabase = createServerClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return request.cookies.getAll();
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value }) =>
            request.cookies.set(name, value)
          );
          response = NextResponse.next({
            request: {
              headers: request.headers,
            },
          });
          cookiesToSet.forEach(({ name, value, options }) =>
            response.cookies.set(name, value, options)
          );
        },
      },
    }
  );

  return { supabase, response };
}
```

---

## 5. Auth Middleware Pattern

### Middleware (`src/middleware.ts`)

```typescript
import { createServerClient } from '@supabase/ssr';
import { NextResponse, type NextRequest } from 'next/server';

// Routes that don't require authentication
const publicRoutes = ['/', '/login', '/signup', '/pricing', '/api/webhooks'];
const authRoutes = ['/login', '/signup'];

export async function middleware(request: NextRequest) {
  let response = NextResponse.next({
    request: {
      headers: request.headers,
    },
  });

  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return request.cookies.getAll();
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value }) =>
            request.cookies.set(name, value)
          );
          response = NextResponse.next({
            request: {
              headers: request.headers,
            },
          });
          cookiesToSet.forEach(({ name, value, options }) =>
            response.cookies.set(name, value, options)
          );
        },
      },
    }
  );

  // Get session
  const {
    data: { session },
  } = await supabase.auth.getSession();

  const { pathname } = request.nextUrl;

  // Allow public routes
  const isPublicRoute = publicRoutes.some(
    (route) => pathname === route || pathname.startsWith('/api/')
  );

  // Redirect unauthenticated users to login
  if (!session && !isPublicRoute) {
    const redirectUrl = new URL('/login', request.url);
    redirectUrl.searchParams.set('redirect', pathname);
    return NextResponse.redirect(redirectUrl);
  }

  // Redirect authenticated users away from auth pages
  if (session && authRoutes.includes(pathname)) {
    return NextResponse.redirect(new URL('/dashboard', request.url));
  }

  return response;
}

export const config = {
  matcher: [
    /*
     * Match all request paths except:
     * - _next/static (static files)
     * - _next/image (image optimization files)
     * - favicon.ico (favicon file)
     * - public folder
     */
    '/((?!_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',
  ],
};
```

### Auth Provider (`src/contexts/auth-context.tsx`)

```typescript
'use client';

import {
  createContext,
  useContext,
  useEffect,
  useState,
  type ReactNode,
} from 'react';
import { type User, type Session } from '@supabase/supabase-js';
import { getSupabaseBrowserClient } from '@/lib/supabase/browser-client';

interface AuthContextType {
  user: User | null;
  session: Session | null;
  loading: boolean;
  signOut: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [session, setSession] = useState<Session | null>(null);
  const [loading, setLoading] = useState(true);
  const supabase = getSupabaseBrowserClient();

  useEffect(() => {
    // Get initial session
    supabase.auth.getSession().then(({ data: { session } }) => {
      setSession(session);
      setUser(session?.user ?? null);
      setLoading(false);
    });

    // Listen for auth changes
    const {
      data: { subscription },
    } = supabase.auth.onAuthStateChange((_event, session) => {
      setSession(session);
      setUser(session?.user ?? null);
      setLoading(false);
    });

    return () => {
      subscription.unsubscribe();
    };
  }, []);

  const signOut = async () => {
    await supabase.auth.signOut();
    window.location.href = '/login';
  };

  return (
    <AuthContext.Provider value={{ user, session, loading, signOut }}>
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
}
```

---

## 6. Realtime Subscription Patterns

### Custom Hook (`src/hooks/use-realtime.ts`)

```typescript
'use client';

import { useEffect, useRef } from 'react';
import { getSupabaseBrowserClient } from '@/lib/supabase/browser-client';
import type { RealtimeChannel } from '@supabase/supabase-js';

interface RealtimeConfig {
  channel: string;
  table: string;
  event?: 'INSERT' | 'UPDATE' | 'DELETE' | '*';
  filter?: string;
  onInsert?: (payload: any) => void;
  onUpdate?: (payload: any) => void;
  onDelete?: (payload: any) => void;
}

export function useRealtime({
  channel,
  table,
  event = '*',
  filter,
  onInsert,
  onUpdate,
  onDelete,
}: RealtimeConfig) {
  const supabase = getSupabaseBrowserClient();
  const channelRef = useRef<RealtimeChannel | null>(null);

  useEffect(() => {
    let dbChannel = supabase.channel(channel);

    dbChannel = dbChannel.on(
      'postgres_changes',
      {
        event,
        schema: 'public',
        table,
        filter,
      },
      (payload) => {
        switch (payload.eventType) {
          case 'INSERT':
            onInsert?.(payload);
            break;
          case 'UPDATE':
            onUpdate?.(payload);
            break;
          case 'DELETE':
            onDelete?.(payload);
            break;
        }
      }
    );

    dbChannel.subscribe();
    channelRef.current = dbChannel;

    return () => {
      if (channelRef.current) {
        supabase.removeChannel(channelRef.current);
      }
    };
  }, [channel, table, event, filter]);

  return channelRef;
}
```

### Usage Example - Conversations

```typescript
'use client';

import { useState } from 'react';
import { useRealtime } from '@/hooks/use-realtime';

export function useConversations(contactId: string) {
  const [conversations, setConversations] = useState<Conversation[]>([]);

  useRealtime({
    channel: `conversations:${contactId}`,
    table: 'conversations',
    filter: `contact_id=eq.${contactId}`,
    onInsert: (payload) => {
      setConversations((prev) => [...prev, payload.new]);
    },
    onUpdate: (payload) => {
      setConversations((prev) =>
        prev.map((conv) =>
          conv.id === payload.new.id ? payload.new : conv
        )
      );
    },
  });

  return { conversations, setConversations };
}
```

---

## 7. API Route Structure for Edge Function Calls

### tRPC Setup (`src/app/api/trpc/[trpc]/route.ts`)

```typescript
import { fetchRequestHandler } from '@trpc/server/adapters/fetch';
import { appRouter } from '@/server/trpc/router';
import { getSupabaseServerClient } from '@/lib/supabase/server-client';

const handler = (req: Request) =>
  fetchRequestHandler({
    endpoint: '/api/trpc',
    req,
    router: appRouter,
    createContext: async () => {
      const supabase = await getSupabaseServerClient();
      const {
        data: { session },
      } = await supabase.auth.getSession();

      return {
        supabase,
        session,
      };
    },
  });

export { handler as GET, handler as POST };
```

### tRPC Router (`src/server/trpc/router.ts`)

```typescript
import { router } from './trpc';
import { contactsRouter } from './routers/contacts';
import { conversationsRouter } from './routers/conversations';
import { aiRouter } from './routers/ai';

export const appRouter = router({
  contacts: contactsRouter,
  conversations: conversationsRouter,
  ai: aiRouter,
});

export type AppRouter = typeof appRouter;
```

### Edge Function Proxy (`src/app/api/edge/[...path]/route.ts`)

```typescript
import { NextRequest, NextResponse } from 'next/server';

const SUPABASE_URL = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const ANON_KEY = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

export async function GET(
  request: NextRequest,
  { params }: { params: { path: string[] } }
) {
  return proxyEdgeFunction(request, params.path);
}

export async function POST(
  request: NextRequest,
  { params }: { params: { path: string[] } }
) {
  return proxyEdgeFunction(request, params.path);
}

async function proxyEdgeFunction(
  request: NextRequest,
  pathSegments: string[]
) {
  const functionName = pathSegments.join('/');
  const url = `${SUPABASE_URL}/functions/v1/${functionName}`;

  const headers = new Headers(request.headers);
  headers.set('Authorization', `Bearer ${ANON_KEY}`);

  // Forward auth context
  const authHeader = request.headers.get('Authorization');
  if (authHeader) {
    headers.set('Authorization', authHeader);
  }

  const response = await fetch(url, {
    method: request.method,
    headers,
    body: request.body,
  });

  const data = await response.json();

  return NextResponse.json(data, {
    status: response.status,
    headers: {
      'Content-Type': 'application/json',
    },
  });
}
```

### Webhook Handler (`src/app/api/webhooks/stripe/route.ts`)

```typescript
import { NextRequest, NextResponse } from 'next/server';
import Stripe from 'stripe';
import { getSupabaseServerClient } from '@/lib/supabase/server-client';

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!);
const webhookSecret = process.env.STRIPE_WEBHOOK_SECRET!;

export async function POST(request: NextRequest) {
  const body = await request.text();
  const signature = request.headers.get('stripe-signature')!;

  let event: Stripe.Event;

  try {
    event = stripe.webhooks.constructEvent(body, signature, webhookSecret);
  } catch (error) {
    console.error('Webhook signature verification failed:', error);
    return NextResponse.json({ error: 'Invalid signature' }, { status: 400 });
  }

  const supabase = await getSupabaseServerClient();

  switch (event.type) {
    case 'checkout.session.completed': {
      const session = event.data.object as Stripe.Checkout.Session;
      const userId = session.client_reference_id;

      await supabase.from('subscriptions').upsert({
        user_id: userId,
        stripe_customer_id: session.customer as string,
        status: 'active',
        plan: session.metadata?.plan,
      });
      break;
    }

    case 'customer.subscription.deleted': {
      const subscription = event.data.object as Stripe.Subscription;
      await supabase
        .from('subscriptions')
        .update({ status: 'cancelled' })
        .eq('stripe_customer_id', subscription.customer as string);
      break;
    }
  }

  return NextResponse.json({ received: true });
}
```

---

## Key Takeaways

| Area | Recommendation |
|------|----------------|
| **Supabase Client** | Use `@supabase/ssr` package for server-side auth with cookies |
| **Auth Pattern** | Middleware-based auth with cookie-based sessions |
| **Realtime** | Custom hooks with cleanup, filter by tenant/contact |
| **API Routes** | tRPC for type-safe APIs, proxy for Edge Functions |
| **State** | Zustand for client state, React Query for server state |
| **Folder Structure** | Clear separation of server/client code per [alaminshaikh.com](https://www.alaminshaikh.com/blog/nextjs-app-router-folder-structure-for-full-stack-projects) |

---

## References

- [supabase.com](https://supabase.com/docs/guides/auth/quickstarts/nextjs) - Next.js Auth Quickstart
- [makerkit.dev](https://makerkit.dev/courses/nextjs-app-router/authentication) - SSR package migration guide
- [alaminshaikh.com](https://www.alaminshaikh.com/blog/nextjs-app-router-folder-structure-for-full-stack-projects) - Full-stack folder structure
- [github.com](https://github.com/rgottardi/nextjs-supabase-multitenant) - Multi-tenant architecture reference
- [supabase.com](https://supabase.com/docs/guides/getting-started/tutorials/with-nextjs) - User Management Tutorial

## architecture-scout
# OpenContact.ai Frontend Architecture Plan

## Research Findings Summary

Based on the provided documentation and search results, I've identified several critical patterns and anti-patterns for Supabase + Next.js integration:

### ðŸš¨ Critical Anti-Patterns to Avoid
- **DO NOT** use `@supabase/auth-helpers-nextjs` (deprecated, will break)
- **DO NOT** use individual cookie methods (`get`, `set`, `remove`)
- **MUST** use `@supabase/ssr` with `getAll()` / `setAll()` cookie pattern

---

## 1. Complete Monorepo Folder Structure

```
opencontact-ai/
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â”œâ”€â”€ ci.yml
â”‚   â”‚   â””â”€â”€ deploy.yml
â”‚   â””â”€â”€ CODEOWNERS
â”‚
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/                          # Next.js 14 frontend
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ app/                  # App Router
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ (auth)/           # Auth route group
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ signup/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ callback/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ (dashboard)/     # Protected routes
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contacts/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ campaigns/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx    # Protected layout
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ (marketing)/     # Public routes
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx     # Landing page
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ pricing/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ api/             # API routes
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contacts/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ campaigns/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ generate/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ analyze/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ webhooks/
â”‚   â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ stripe/
â”‚   â”‚   â”‚   â”‚   â”‚       â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ supabase/
â”‚   â”‚   â”‚   â”‚   â”‚           â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx       # Root layout
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ not-found.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ui/               # shadcn/ui components
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ form.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ table.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login-form.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ signup-form.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth-provider.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ protected-route.tsx
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ stats-card.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ recent-activity.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ chart-container.tsx
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contacts/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contact-list.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contact-card.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contact-form.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ contact-import.tsx
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ campaigns/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ campaign-list.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ campaign-builder.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ campaign-analytics.tsx
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ message-generator.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sentiment-analyzer.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ai-suggestions.tsx
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ header.tsx
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ sidebar.tsx
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ footer.tsx
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ mobile-nav.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ browser-client.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ server-client.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ middleware-client.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ use-auth.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ use-contacts.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ use-campaigns.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ use-realtime.ts
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ cn.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ formatters.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ validators.ts
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ constants/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ routes.ts
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ config.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ database.ts        # Supabase generated types
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contact.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ campaign.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ middleware.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”‚   â”œâ”€â”€ favicon.ico
â”‚   â”‚   â”‚   â”œâ”€â”€ logo.svg
â”‚   â”‚   â”‚   â””â”€â”€ og-image.png
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ .env.local
â”‚   â”‚   â”œâ”€â”€ .env.example
â”‚   â”‚   â”œâ”€â”€ next.config.js
â”‚   â”‚   â”œâ”€â”€ tailwind.config.ts
â”‚   â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”‚   â”œâ”€â”€ components.json         # shadcn/ui config
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ docs/                        # Documentation site (optional)
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ shared/                      # Shared utilities
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â””â”€â”€ constants/
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â”‚
â”‚   â””â”€â”€ ui/                          # Shared UI components
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â””â”€â”€ components/
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ functions/                   # Edge Functions
â”‚   â”‚   â”œâ”€â”€ ai-generate/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ ai-analyze/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ stripe-webhook/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ _shared/
â”‚   â”‚       â””â”€â”€ supabase-client.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ migrations/
â”‚   â”‚   â”œâ”€â”€ 20240101000000_initial_schema.sql
â”‚   â”‚   â”œâ”€â”€ 20240102000000_contacts.sql
â”‚   â”‚   â”œâ”€â”€ 20240103000000_campaigns.sql
â”‚   â”‚   â””â”€â”€ 20240104000000_rls_policies.sql
â”‚   â”‚
â”‚   â”œâ”€â”€ seed.sql
â”‚   â””â”€â”€ config.toml
â”‚
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json                     # Root package.json
â”œâ”€â”€ turbo.json                       # Turborepo config
â”œâ”€â”€ pnpm-workspace.yaml
â””â”€â”€ README.md
```

---

## 2. Environment Variables Template

### `.env.local` (apps/web/)

```bash
# ===========================================
# Supabase Configuration
# ===========================================
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# New publishable key format (Supabase 2026+)
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY=sb_publishable_...

# ===========================================
# AI Services (for Edge Functions)
# ===========================================
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...

# ===========================================
# Stripe Configuration
# ===========================================
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_...
STRIPE_SECRET_KEY=sk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...

# ===========================================
# Application Configuration
# ===========================================
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_APP_NAME=OpenContact.ai

# ===========================================
# OAuth Providers (optional)
# ===========================================
# Google OAuth
NEXT_PUBLIC_GOOGLE_OAUTH_ENABLED=true

# GitHub OAuth
NEXT_PUBLIC_GITHUB_OAUTH_ENABLED=false
```

---

## 3. Package Dependencies

### `package.json` (apps/web/)

```json
{
  "name": "@opencontact/web",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "type-check": "tsc --noEmit",
    "db:types": "supabase gen types typescript --project-id $PROJECT_ID > src/types/database.ts"
  },
  "dependencies": {
    "next": "^14.2.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    
    "@supabase/supabase-js": "^2.39.0",
    "@supabase/ssr": "^0.6.0",
    
    "@radix-ui/react-dialog": "^1.0.5",
    "@radix-ui/react-dropdown-menu": "^2.0.6",
    "@radix-ui/react-label": "^2.0.2",
    "@radix-ui/react-select": "^2.0.0",
    "@radix-ui/react-slot": "^1.0.2",
    "@radix-ui/react-toast": "^1.1.5",
    
    "@tanstack/react-query": "^5.17.0",
    "@tanstack/react-table": "^8.11.0",
    
    "react-hook-form": "^7.49.0",
    "@hookform/resolvers": "^3.3.2",
    "zod": "^3.22.4",
    
    "tailwindcss": "^3.4.0",
    "class-variance-authority": "^0.7.0",
    "clsx": "^2.1.0",
    "tailwind-merge": "^2.2.0",
    "lucide-react": "^0.309.0",
    
    "date-fns": "^3.2.0",
    "recharts": "^2.10.0"
  },
  "devDependencies": {
    "@types/node": "^20.11.0",
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "typescript": "^5.3.0",
    "eslint": "^8.56.0",
    "eslint-config-next": "^14.2.0",
    "prettier": "^3.2.0",
    "prettier-plugin-tailwindcss": "^0.5.11"
  }
}
```

---

## 4. Supabase Client Initialization Pattern

### `src/lib/supabase/browser-client.ts`

```typescript
import { createBrowserClient } from '@supabase/ssr'
import type { Database } from '@/types/database'

let client: ReturnType<typeof createBrowserClient<Database>> | undefined

/**
 * Browser-side Supabase client
 * Singleton pattern to prevent multiple instances
 */
export function getSupabaseBrowserClient() {
  if (client) {
    return client
  }

  client = createBrowserClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  )

  return client
}
```

### `src/lib/supabase/server-client.ts`

```typescript
import { createServerClient } from '@supabase/ssr'
import { cookies } from 'next/headers'
import type { Database } from '@/types/database'

/**
 * Server-side Supabase client for Server Components
 * MUST use getAll/setAll cookie pattern
 */
export async function getSupabaseServerClient() {
  const cookieStore = await cookies()

  return createServerClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll()
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value, options }) => {
            try {
              cookieStore.set(name, value, options)
            } catch {
              // Handle cookie setting in middleware context
              // This can fail in Server Components during rendering
            }
          })
        },
      },
    }
  )
}
```

### `src/lib/supabase/middleware-client.ts`

```typescript
import { createServerClient } from '@supabase/ssr'
import { NextResponse, type NextRequest } from 'next/server'
import type { Database } from '@/types/database'

/**
 * Supabase client for middleware
 * Handles auth token refresh in middleware
 */
export function getSupabaseMiddlewareClient(request: NextRequest) {
  let response = NextResponse.next({
    request,
  })

  const supabase = createServerClient<Database>(


## requirements-analyst
Okay, I will proceed with creating detailed technical specifications for the 10 pages of OpenContact.ai, outlining TypeScript interfaces, component hierarchy, state management, user flows, and acceptance criteria, as well as documenting data contracts for the listed Edge Functions.

## OpenContact.ai Page Technical Specifications

**Assumptions:**

*   The project utilizes TypeScript, React, Next.js 14 (App Router), and Tailwind CSS as outlined in the architecture document.
*   Supabase is used for authentication and data persistence.
*   `shadcn/ui` components are available for UI elements.
*   Zod is used for form validation.
*   "@opencontact/shared" & "@opencontact/ui" monorepo packages are available.

### 1. Landing Page `/`

*   **Purpose:** Public-facing marketing page to introduce OpenContact.ai and its features.
*   **User Flow:** User visits the page -> Reads content -> Clicks "Sign Up" or "Login" CTA.

**Technical Specifications:**

*   **TypeScript Interfaces:**
    *   None (static content, no API calls).
*   **Component Hierarchy:**
    ```
    Page (app/page.tsx)
     â”œâ”€â”€ (marketing)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ Header (components/layout/header.tsx)
     â”‚   â”œâ”€â”€ HeroSection
     â”‚   â”œâ”€â”€ FeaturesSection
     â”‚   â”œâ”€â”€ TestimonialsSection
     â”‚   â”œâ”€â”€ PricingPreviewSection
     â”‚   â””â”€â”€ Footer (components/layout/footer.tsx)
    ```
*   **State Management:** None.
*   **Acceptance Criteria:**
    *   Visually appealing and responsive design.
    *   Clear and concise presentation of OpenContact.ai's value proposition.
    *   CTAs link correctly to signup and login pages.
    *   SEO metadata is correctly configured.
*   **Edge Functions Data Contracts**: None

### 2. Login Page `/login`

*   **Purpose:** Allow existing users to authenticate.
*   **User Flow:** User navigates to `/login` -> Enters credentials -> Clicks "Login" -> Redirects to dashboard (`/dashboard`) on success or displays error on failure.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    // Request (Credential-based; could extend for OAuth)
    interface LoginFormValues {
      email: string;
      password?: string;
    }

    //This leverages Supabase's auth response and types.
    type AuthResponse =
      | {
          data: {
            session: Session | null;
            user: User | null;
          };
          error: null;
        }
      | {
          data: {
            session: null;
            user: null;
          };
          error: AuthError;
        };
    ```

*   **Component Hierarchy:**

    ```
    Page (app/(auth)/login/page.tsx)
     â”œâ”€â”€ (auth)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ LoginForm (components/auth/login-form.tsx)
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
     â”‚   â”‚   â””â”€â”€ Link (next/link)
    ```

*   **State Management:**
    *   Form state (using `react-hook-form`)
    *   Loading state
    *   Error state (for displaying login errors).
*   **Acceptance Criteria:**
    *   Form validation with appropriate error messages.
    *   Successful login redirects to `/dashboard`.
    *   Error messages are displayed for invalid credentials or server errors.
    *   "Forgot Password" link is present and functional.
    *   OAuth Login option.
*   **Edge Functions Data Contracts**: None

### 3. Signup Page `/signup`

*   **Purpose:** Allow new users to create an account.
*   **User Flow:** User navigates to `/signup` -> Enters required information -> Clicks "Sign Up" -> Account created; redirected to `/onboarding` or displays error messages.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface SignupFormValues {
      email: string;
      password?: string;
    }
    //This leverages Supabase's auth response and types.
    type AuthResponse =
      | {
          data: {
            session: Session | null;
            user: User | null;
          };
          error: null;
        }
      | {
          data: {
            session: null;
            user: null;
          };
          error: AuthError;
        };
    ```

*   **Component Hierarchy:**

    ```
    Page (app/(auth)/signup/page.tsx)
     â”œâ”€â”€ (auth)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ SignupForm (components/auth/signup-form.tsx)
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
     â”‚   â”‚   â””â”€â”€ Link (next/link)
    ```

*   **State Management:**
    *   Form state (using `react-hook-form`).
    *   Loading state.
    *   Error state.
*   **Acceptance Criteria:**
    *   Form validation with appropriate error messages.
    *   Successful signup creates a new user in Supabase Auth and redirects to `/onboarding`.
    *   Error messages are displayed for invalid input or server errors (e.g., email already exists).
*   **Edge Functions Data Contracts**: None

### 4. Onboarding Page `/onboarding`

*   **Purpose:** Guide new users through initial setup and configuration.
*   **User Flow:** User completes onboarding steps -> Integrates services, sets preferences, etc. -> Redirects to `/scan` or `/dashboard`.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface OnboardingFormValues {
      fullName: string;
      companyName?: string;
      // other settings/preferences
    }

    interface IntegrationStatus {
      service: 'google' | 'stripe' | 'other';
      isConnected: boolean;
    }

    interface UpdateUserMetadataRequest {
        fullName: string;
        companyName?: string;
        // ... other profile fields
    }

    interface UpdateUserMetadataResponse {
        success: boolean;
        error?: string;
    }

    ```

*   **Component Hierarchy:**

    ```
    Page (app/onboarding/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout - since it's a protected route)
     â”‚   â”œâ”€â”€ OnboardingForm
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Select (ui/select.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
     â”‚   â”‚   â”œâ”€â”€ IntegrationCard (components/onboarding/integration-card.tsx)
    ```

*   **State Management:**
    *   Form state (using `react-hook-form`).
    *   Loading state.
    *   Integration status (e.g., connected to Google, Stripe).
*   **Acceptance Criteria:**
    *   User can complete all onboarding steps.
    *   Integration status is correctly displayed.
    *   Settings are saved to the user's profile in Supabase.
    *   Redirects to `/scan` or `/dashboard` after completion.
*   **Edge Functions Data Contracts**: None

### 5. Scan Page `/scan`

*   **Purpose:** Initiate contact scanning process.
*   **User Flow:** User navigates to `/scan` -> Uploads business card or another source -> The scan initiates -> Contacts are processed -> Updates contact data in db.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface ScanFormValues {
      image: File;
    }

    interface ScanResponse {
      status: 'processing' | 'complete' | 'error';
      contacts?: Contact[]; // Assuming a Contact interface
      error?: string;
    }
    ```

*   **Component Hierarchy:**

    ```
    Page (app/scan/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ ScanForm
     â”‚   â”‚   â”œâ”€â”€ FileUploader
     â”‚   â”‚   â”œâ”€â”€ Button
     â”‚   â”œâ”€â”€ ScanResults
     â”‚   â”‚   â”œâ”€â”€ ContactList
    ```

*   **State Management:**
    *   Scanning state (loading, processing, complete).
    *   Scan results (list of contacts).
    *   Error state.
*   **Acceptance Criteria:**
    *   User can upload image(s).
    *   Scanning process is initiated upon submission.
    *   Scanned contacts are displayed once processing completes.
    *   Errors handled gracefully.
    *   Contacts stored in database after processing completes.
*   **Edge Functions Data Contracts**:

    *   **`process-card`**:
        *   **Input:** `File` (image of business card)
        *   **Output:**

            ```typescript
            interface ProcessCardResponse {
              status: 'success' | 'failure';
              data?: {
                name: string;
                email: string;
                phone: string;
                title: string;
                company: string;
                // ... other relevant fields
              };
              error?: string;
            }
            ```

### 6. Dashboard Page `/dashboard`

*   **Purpose:** Provide an overview of key metrics and recent activity.
*   **User Flow:** User navigates to `/dashboard` -> Views summary data, recent contacts, campaign performance.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface DashboardStats {
      totalContacts: number;
      activeCampaigns: number;
      recentActivity: ActivityItem[];
      // other metrics
    }

    interface ActivityItem {
      type: 'contact_added' | 'campaign_sent';
      timestamp: string;
      description: string;
    }
    ```

*   **Component Hierarchy:**

    ```
    Page (app/(dashboard)/dashboard/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ StatsCard (components/dashboard/stats-card.tsx)
     â”‚   â”œâ”€â”€ RecentActivity (components/dashboard/recent-activity.tsx)
     â”‚   â”œâ”€â”€ ChartContainer (components/dashboard/chart-container.tsx)
    ```

*   **State Management:**
    *   Real-time data updates using Supabase Realtime (ideally a custom hook wrapping this).
    *   Error states
*   **Acceptance Criteria:**
    *   Key metrics are displayed accurately and updated regularly.
    *   Recent activity is shown chronologically.
    *   Navigational elements to other sections of the applications.
*   **Edge Functions Data Contracts**:

    *   **`dashboard-stats`**:
        *   **Input:** `userId: string` (obtained from session)
        *   **Output:**

            ```typescript
            interface DashboardStatsResponse {
              totalContacts: number;
              activeCampaigns: number;
              leadsGenerated: number;
              // ... other stats
            }
            ```

### 7. Contact Detail Page `/contacts/[id]`

*   **Purpose:** Display detailed information about a specific contact and allow editing.
*   **User Flow:** User navigates to `/contacts/[id]` -> Views contact details -> Edits contact information -> Saves changes.

**Technical Specifications:**

*   **TypeScript Interfaces:**

```typescript
    interface Contact {
      id: string;
      firstName: string;
      lastName: string;
      email: string;
      phone: string;
      company?: string;
      jobTitle?: string;
      notes?: string;
      // ... other contact fields
    }

    interface UpdateContactRequest {
      firstName: string;
      lastName: string;
      email: string;
      phone: string;
      company?: string;
      jobTitle?: string;
      notes?: string;
      // ... other fields to be updated
}
```

*   **Component Hierarchy:**

```
    Page (app/(dashboard)/contacts/[id]/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ ContactCard (components/contacts/contact-card.tsx)
     â”‚   â”œâ”€â”€ ContactForm (components/contacts/contact-form.tsx)
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Textarea (ui/textarea.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
```

*   **State Management:**
    *   Contact data (fetched from Supabase).
    *   Form state (using `react-hook-form`).
    *   Loading state.
    *   Edit state.
*   **Acceptance Criteria:**
    *   Contact details are displayed correctly.
    *   User can edit contact information and save changes.
    *   Changes are persisted to Supabase.
    *   Real-time updates for other users viewing the same contact.
*   **Edge Functions Data Contracts**:

    *   **`contact-detail`**:
        *   **Input:** `contactId: string, userId: string` (obtained from session)
        *   **Output:**

            ```typescript
            interface ContactDetailResponse {
              id: string;
              firstName: string;
              lastName: string;
              email: string;
              phone: string;
              company?: string;
              jobTitle?: string;
              notes?: string;
              ownerId: string;
            }
            ```

### 8. Claim Page `/claim/[token]`

*   **Purpose:** Handle cases where a contact profile is being claimed
*   **User Flow:** User receives email -> Clicks link with claim token -> Profile auto-filled -> Saves new profile

**Technical Specifications:**

*   **TypeScript Interfaces:**

```typescript
interface Claim {
    claim_code: UUID
    contact_id: UUID
    contact_email: string
    user_id: UUID
    created_at: Date
    claimed_at: Date
}
interface ClaimFormValues {
  firstName: string;
  lastName: string;
  email: string;
}
```

*   **Component Hierarchy:**

```
    Page (app/claim/[token]/page.tsx)
     â”œâ”€â”€ ClaimForm (components/claim-form.tsx)
     â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”œâ”€â”€ Textarea (ui/textarea.tsx)
     â”‚   â”œâ”€â”€ Button (ui/button.tsx)
```

*   **State Management:**
    *   Claim data (fetched from Supabase).
    *   Form state (using `react-hook-form`).
    *   Loading state.
*   **Acceptance Criteria:**
    *   Form is pre-filled.
    *   Token gets invalidated after claimed.
    *   Contact relationship established between contact model and profile.
*   **Edge Functions Data Contracts**:

    *   **`claim-profile`**:
        *   **Input:** `claim_code: string`
        *   **Output:**

            ```typescript
interface ClaimProfileResponse {
    claim_code: UUID
    contact_id: UUID
    contact_email: string
    user_id: UUID
    created_at: Date
    claimed_at: Date
}
            ```
### 9. Settings Page `/settings`

*   **Purpose:** Allow users to manage their account preferences, integrations, and subscription.
*   **User Flow:** User navigates to `/settings` -> Updates profile information, connects/disconnects integrations, manages subscription.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface SettingsFormValues {
      fullName: string;
      email: string;
      // Add new settings here
    }
    ```

*   **Component Hierarchy:**

    ```
    Page (app/(dashboard)/settings/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ ProfileSettings (components/settings/profile-settings.tsx)  #SettingsForm lives here
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
     â”‚   â”œâ”€â”€ IntegrationSettings (components/settings/integration-settings.tsx)
     â”‚   â”œâ”€â”€ SubscriptionSettings (components/settings/subscription-settings.tsx)
    ```

*   **State Management:**
    *   Settings data (fetched from Supabase).
    *   Form state (using `react-hook-form`).
    *   Loading state.
*   **Acceptance Criteria:**
    *   Settings are displayed correctly.
    *   User can update profile information and save changes.
    *   Integration status are correctly tracked.
    *   Actions like "Disconnect" or "Change Plan" work according to design
*   **Edge Functions Data Contracts**:
    *   **`update-profile`**:
        *   **Input:** `userId: string`, `SettingsFormValues` (obtained from form).
        *   **Output:**

            ```typescript
            interface UpdateProfileResponse {
              success: boolean;
              message?: string;
            }
            ```

### 10. Pricing Page `/pricing`

*   **Purpose:** Display available pricing plans and allow users to subscribe.
*   **User Flow:** User navigates to `/pricing` -> Views plans -> Selects plan -> Redirected to Stripe checkout.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface PricingPlan {
      id: string;
      name: string;
      price: number;
      features: string[];
    }
    ```

*   **Component Hierarchy:**

    ```
    Page (app/(marketing)/pricing/page.tsx)
     â”œâ”€â”€ (marketing)/layout.tsx
     â”‚   â”œâ”€â”€ PricingCard (components/pricing/pricing-card.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
    ```

*   **State Management:**
    *   None.
*   **Acceptance Criteria:**
    *   Pricing plans are displayed correctly.
    *   User

## requirements-analyst
Okay, I will enhance the provided technical specifications for the 10 pages of OpenContact.ai, detailing data contracts for the listed Edge Functions and augmenting existing sections with relevant information.

## OpenContact.ai Page Technical Specifications (Revised)

**Assumptions:**

*   The project utilizes TypeScript, React, Next.js 14 (App Router), and Tailwind CSS as outlined in the architecture document.
*   Supabase is used for authentication and data persistence.
*   `shadcn/ui` components are available for UI elements.
*   Zod is used for form validation.
*   "@opencontact/shared" & "@opencontact/ui" monorepo packages are available.

### 1. Landing Page `/`

*   **Purpose:** Public-facing marketing page to introduce OpenContact.ai and its features.
*   **User Flow:** User visits the page -> Reads content -> Clicks "Sign Up" or "Login" CTA.

**Technical Specifications:**

*   **TypeScript Interfaces:**
    *   None (static content, no API calls).
*   **Component Hierarchy:**
    ```
    Page (app/page.tsx)
     â”œâ”€â”€ (marketing)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ Header (components/layout/header.tsx)
     â”‚   â”œâ”€â”€ HeroSection
     â”‚   â”œâ”€â”€ FeaturesSection
     â”‚   â”œâ”€â”€ TestimonialsSection
     â”‚   â”œâ”€â”€ PricingPreviewSection
     â”‚   â””â”€â”€ Footer (components/layout/footer.tsx)
    ```
*   **State Management:** None.
*   **Acceptance Criteria:**
    *   Visually appealing and responsive design.
    *   Clear and concise presentation of OpenContact.ai's value proposition.
    *   CTAs link correctly to signup and login pages.
    *   SEO metadata is correctly configured.
*   **Edge Functions Data Contracts**: None

### 2. Login Page `/login`

*   **Purpose:** Allow existing users to authenticate.
*   **User Flow:** User navigates to `/login` -> Enters credentials -> Clicks "Login" -> Redirects to dashboard (`/dashboard`) on success or displays error on failure.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    // Request (Credential-based; could extend for OAuth)
    interface LoginFormValues {
      email: string;
      password?: string;
    }

    //This leverages Supabase's auth response and types.
    type AuthResponse =
      | {
          data: {
            session: Session | null;
            user: User | null;
          };
          error: null;
        }
      | {
          data: {
            session: null;
            user: null;
          };
          error: AuthError;
        };
    ```
*   **Security Considerations**
    *  Rate limit attempts login to prevent brute-force attacks.
    *  Implement CSRF protection.

*   **Component Hierarchy:**

    ```
    Page (app/(auth)/login/page.tsx)
     â”œâ”€â”€ (auth)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ LoginForm (components/auth/login-form.tsx)
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
     â”‚   â”‚   â””â”€â”€ Link (next/link)
    ```

*   **State Management:**
    *   Form state (using `react-hook-form`)
    *   Loading state
    *   Error state (for displaying login errors).
*   **Acceptance Criteria:**
    *   Form validation with appropriate error messages.
    *   Successful login redirects to `/dashboard`.
    *   Error messages are displayed for invalid credentials or server errors.
    *   "Forgot Password" link is present and functional.
    *   OAuth Login option.
*   **Edge Functions Data Contracts**: None

### 3. Signup Page `/signup`

*   **Purpose:** Allow new users to create an account.
*   **User Flow:** User navigates to `/signup` -> Enters required information -> Clicks "Sign Up" -> Account created; redirected to `/onboarding` or displays error messages.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface SignupFormValues {
      email: string;
      password?: string;
    }
    //This leverages Supabase's auth response and types.
    type AuthResponse =
      | {
          data: {
            session: Session | null;
            user: User | null;
          };
          error: null;
        }
      | {
          data: {
            session: null;
            user: null;
          };
          error: AuthError;
        };
    ```

*   **Component Hierarchy:**

    ```
    Page (app/(auth)/signup/page.tsx)
     â”œâ”€â”€ (auth)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ SignupForm (components/auth/signup-form.tsx)
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
     â”‚   â”‚   â””â”€â”€ Link (next/link)
    ```

*   **State Management:**
    *   Form state (using `react-hook-form`).
    *   Loading state.
    *   Error state.
*   **Acceptance Criteria:**
    *   Form validation with appropriate error messages.
    *   Successful signup creates a new user in Supabase Auth and redirects to `/onboarding`.
    *   Error messages are displayed for invalid input or server errors (e.g., email already exists).
*   **Edge Functions Data Contracts**: None

### 4. Onboarding Page `/onboarding`

*   **Purpose:** Guide new users through initial setup and configuration.
*   **User Flow:** User completes onboarding steps -> Integrates services, sets preferences, etc. -> Redirects to `/scan` or `/dashboard`.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface OnboardingFormValues {
      fullName: string;
      companyName?: string;
      //other settings/preferences
    }

    interface IntegrationStatus {
      service: 'google' | 'stripe' | 'other';
      isConnected: boolean;
    }

    interface UpdateUserMetadataRequest {
        fullName: string;
        companyName?: string;
        //... other profile fields
    }

    interface UpdateUserMetadataResponse {
        success: boolean;
        error?: string;
    }

    ```

*   **Component Hierarchy:**

    ```
    Page (app/onboarding/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout - since it's a protected route)
     â”‚   â”œâ”€â”€ OnboardingForm
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Select (ui/select.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
     â”‚   â”‚   â”œâ”€â”€ IntegrationCard (components/onboarding/integration-card.tsx)
    ```

*   **State Management:**
    *   Form state (using `react-hook-form`).
    *   Loading state.
    *   Integration status (e.g., connected to Google, Stripe).
*   **Acceptance Criteria:**
    *   User can complete all onboarding steps.
    *   Integration status is correctly displayed.
    *   Settings are saved to the user's profile in Supabase.
    *   Redirects to `/scan` or `/dashboard` after completion.
*   **Edge Functions Data Contracts**: None

### 5. Scan Page `/scan`

*   **Purpose:** Initiate contact scanning process.
*   **User Flow:** User navigates to `/scan` -> Uploads business card or another source -> The scan initiates -> Contacts are processed -> Updates contact data in db.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface ScanFormValues {
      image: File;
    }

    interface ScanResponse {
      status: 'processing' | 'complete' | 'error';
      contacts?: Contact[]; // Assuming a Contact interface
      error?: string;
    }
    ```

*   **Component Hierarchy:**

    ```
    Page (app/scan/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ ScanForm
     â”‚   â”‚   â”œâ”€â”€ FileUploader
     â”‚   â”‚   â”œâ”€â”€ Button
     â”‚   â”œâ”€â”€ ScanResults
     â”‚   â”‚   â”œâ”€â”€ ContactList
    ```

*   **State Management:**
    *   Scanning state (loading, processing, complete).
    *   Scan results (list of contacts).
    *   Error state.
*   **Acceptance Criteria:**
    *   User can upload image(s).
    *   Scanning process is initiated upon submission.
    *   Scanned contacts are displayed once processing completes.
    *   Errors handled gracefully.
    *   Contacts stored in database after processing completes.
*   **Edge Functions Data Contracts**:

    *   **`process-card`**:
        *   **Input:** `File` (image of business card)
        *   **Output:**

            ```typescript
            interface ProcessCardResponse {
              status: 'success' | 'failure';
              data?: {
                name: string;
                email: string;
                phone: string;
                title: string;
                company: string;
                //... other relevant fields
              };
              error?: string;
            }
            ```

### 6. Dashboard Page `/dashboard`

*   **Purpose:** Provide an overview of key metrics and recent activity.
*   **User Flow:** User navigates to `/dashboard` -> Views summary data, recent contacts, campaign performance.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface DashboardStats {
      totalContacts: number;
      activeCampaigns: number;
      recentActivity: ActivityItem[];
      //... other metrics
    }

    interface ActivityItem {
      type: 'contact_added' | 'campaign_sent';
      timestamp: string;
      description: string;
    }
    ```

*   **Component Hierarchy:**

    ```
    Page (app/(dashboard)/dashboard/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ StatsCard (components/dashboard/stats-card.tsx)
     â”‚   â”œâ”€â”€ RecentActivity (components/dashboard/recent-activity.tsx)
     â”‚   â”œâ”€â”€ ChartContainer (components/dashboard/chart-container.tsx)
    ```

*   **State Management:**
    *   Real-time data updates using Supabase Realtime (ideally a custom hook wrapping this). This includes:
        *   Total Contacts
        *   Active Campaigns
    *   Error states
*   **Acceptance Criteria:**
    *   Key metrics are displayed accurately and updated regularly.
    *   Recent activity is shown chronologically.
    *   Navigational elements to other sections of the applications.
*   **Edge Functions Data Contracts**:

    *   **`dashboard-stats`**:
        *   **Input:** `userId: string` (obtained from session)
        *   **Output:**

            ```typescript
            interface DashboardStatsResponse {
              totalContacts: number;
              activeCampaigns: number;
              leadsGenerated: number;
              //... other stats
            }
            ```

### 7. Contact Detail Page `/contacts/[id]`

*   **Purpose:** Display detailed information about a specific contact and allow editing.
*   **User Flow:** User navigates to `/contacts/[id]` -> Views contact details -> Edits contact information -> Saves changes.

**Technical Specifications:**

*   **TypeScript Interfaces:**

```typescript
    interface Contact {
      id: string;
      firstName: string;
      lastName: string;
      email: string;
      phone: string;
      company?: string;
      jobTitle?: string;
      notes?: string;
      //... other contact fields
    }

    interface UpdateContactRequest {
      firstName: string;
      lastName: string;
      email: string;
      phone: string;
      company?: string;
      jobTitle?: string;
      notes?: string;
      //... other fields to be updated
}
```

*   **Component Hierarchy:**

```
    Page (app/(dashboard)/contacts/[id]/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ ContactCard (components/contacts/contact-card.tsx)
     â”‚   â”œâ”€â”€ ContactForm (components/contacts/contact-form.tsx)
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Textarea (ui/textarea.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
```

*   **State Management:**
    *   Contact data (fetched from Supabase).
    *   Form state (using `react-hook-form`).
    *   Loading state.
    *   Edit state.
*   **Acceptance Criteria:**
    *   Contact details are displayed correctly.
    *   User can edit contact information and save changes.
    *   Changes are persisted to Supabase.
    *   Real-time updates for other users viewing the same contact.
*   **Edge Functions Data Contracts**:

    *   **`contact-detail`**:
        *   **Input:** `contactId: string, userId: string` (obtained from session)
        *   **Output:**

            ```typescript
            interface ContactDetailResponse {
              id: string;
              firstName: string;
              lastName: string;
              email: string;
              phone: string;
              company?: string;
              jobTitle?: string;
              notes?: string;
              ownerId: string;
            }
            ```
    *   **`contacts-list`**: (*Implicitly called to refresh main Contacts view*)
        *   **Input**: `userId: string`
        *   **Output**:

            ```typescript
            interface ContactListResponse {
                contacts: ContactDetailResponse[];
                totalCount: number;
            }
            ```

### 8. Claim Page `/claim/[token]`

*   **Purpose:** Handle cases where a contact profile is being claimed
*   **User Flow:** User receives email -> Clicks link with claim token -> Profile auto-filled -> Saves new profile

**Technical Specifications:**

*   **TypeScript Interfaces:**

```typescript
interface Claim {
    claim_code: UUID
    contact_id: UUID
    contact_email: string
    user_id: UUID
    created_at: Date
    claimed_at: Date
}
interface ClaimFormValues {
  firstName: string;
  lastName: string;
  email: string;
}
```

*   **Component Hierarchy:**

```
    Page (app/claim/[token]/page.tsx)
     â”œâ”€â”€ ClaimForm (components/claim-form.tsx)
     â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”œâ”€â”€ Textarea (ui/textarea.tsx)
     â”‚   â”œâ”€â”€ Button (ui/button.tsx)
```

*   **State Management:**
    *   Claim data (fetched from Supabase).
    *   Form state (using `react-hook-form`).
    *   Loading state.
*   **Acceptance Criteria:**
    *   Form is pre-filled.
    *   Token gets invalidated after claimed.
    *   Contact relationship established between contact model and profile.
*   **Edge Functions Data Contracts**:

    *   **`claim-profile`**:
        *   **Input:** `claim_code: string`
        *   **Output:**

            ```typescript
interface ClaimProfileResponse {
    claim_code: UUID
    contact_id: UUID
    contact_email: string
    user_id: UUID
    created_at: Date
    claimed_at: Date
}
            ```

### 9. Settings Page `/settings`

*   **Purpose:** Allow users to manage their account preferences, integrations, and subscription.
*   **User Flow:** User navigates to `/settings` -> Updates profile information, connects/disconnects integrations, manages subscription.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface SettingsFormValues {
      fullName: string;
      email: string;
      //Add new settings here
    }
    ```

*   **Component Hierarchy:**

    ```
    Page (app/(dashboard)/settings/page.tsx)
     â”œâ”€â”€ (dashboard)/layout.tsx (layout)
     â”‚   â”œâ”€â”€ ProfileSettings (components/settings/profile-settings.tsx)  #SettingsForm lives here
     â”‚   â”‚   â”œâ”€â”€ Input (ui/input.tsx)
     â”‚   â”‚   â”œâ”€â”€ Button (ui/button.tsx)
     â”‚   â”œâ”€â”€ IntegrationSettings (components/settings/integration-settings.tsx)
     â”‚   â”œâ”€â”€ SubscriptionSettings (components/settings/subscription-settings.tsx)
    ```

*   **State Management:**
    *   Settings data (fetched from Supabase).
    *   Form state (using `react-hook-form`).
    *   Loading state.
*   **Acceptance Criteria:**
    *   Settings are displayed correctly.
    *   User can update profile information and save changes.
    *   Integration status integration settings section are correctly tracked.
    *   Actions like "Disconnect" in the IntegrationsSetting, or "Change Plan" in SubscriptionSetting, buttons work according to design
*   **Edge Functions Data Contracts**:
    *   **`update-profile`**:
        *   **Input:** `userId: string`, `SettingsFormValues` (obtained from form).
        *   **Output:**

            ```typescript
            interface UpdateProfileResponse {
              success: boolean;
              message?: string;
            }
            ```

### 10. Pricing Page `/pricing`

*   **Purpose:** Display available pricing plans and allow users to subscribe.
*   **User Flow:** User navigates to `/pricing` -> Views plans -> Selects plan -> Redirected to Stripe checkout.

**Technical Specifications:**

*   **TypeScript Interfaces:**

    ```typescript
    interface PricingPlan {
      id: string;
      name: string;


## core-builder
I'll build the foundational OpenContact.ai codebase with all the required components. Note: Based on the research findings, I'll use `@supabase/ssr` (the recommended package) instead of the deprecated `@supabase/auth-helpers-nextjs`.

```json
{
  "name": "opencontact-ai",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "turbo dev --filter=web",
    "build": "turbo build --filter=web",
    "lint": "turbo lint --filter=web",
    "type-check": "turbo type-check --filter=web",
    "db:types": "supabase gen types typescript --project-id $SUPABASE_PROJECT_ID > apps/web/src/types/database.ts"
  },
  "devDependencies": {
    "turbo": "^2.3.0",
    "typescript": "^5.6.3"
  },
  "packageManager": "pnpm@9.12.2",
  "pnpm": {
    "overrides": {
      "react": "^18.3.1",
      "react-dom": "^18.3.1"
    }
  }
}
```

---

```json
{
  "name": "@opencontact/web",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev --turbo",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "type-check": "tsc --noEmit"
  },
  "dependencies": {
    "@anthropic-ai/sdk": "^0.30.1",
    "@hookform/resolvers": "^3.9.1",
    "@radix-ui/react-avatar": "^1.1.2",
    "@radix-ui/react-dialog": "^1.1.4",
    "@radix-ui/react-dropdown-menu": "^2.1.4",
    "@radix-ui/react-label": "^2.1.1",
    "@radix-ui/react-select": "^2.1.4",
    "@radix-ui/react-separator": "^1.1.1",
    "@radix-ui/react-slot": "^1.1.1",
    "@radix-ui/react-toast": "^1.2.4",
    "@radix-ui/react-tooltip": "^1.1.6",
    "@supabase/ssr": "^0.5.2",
    "@supabase/supabase-js": "^2.47.10",
    "@tanstack/react-query": "^5.62.7",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "date-fns": "^4.1.0",
    "framer-motion": "^11.15.0",
    "lucide-react": "^0.468.0",
    "next": "^14.2.18",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-hook-form": "^7.54.0",
    "sonner": "^1.7.1",
    "stripe": "^17.4.0",
    "tailwind-merge": "^2.6.0",
    "tailwindcss-animate": "^1.0.7",
    "zod": "^3.24.1",
    "zustand": "^5.0.2"
  },
  "devDependencies": {
    "@types/node": "^22.10.1",
    "@types/react": "^18.3.16",
    "@types/react-dom": "^18.3.5",
    "autoprefixer": "^10.4.20",
    "eslint": "^9.16.0",
    "eslint-config-next": "^14.2.18",
    "postcss": "^8.4.49",
    "prettier": "^3.4.2",
    "prettier-plugin-tailwindcss": "^0.6.9",
    "tailwindcss": "^3.4.17",
    "typescript": "^5.6.3"
  }
}
```

---

```javascript
/** @type {import('tailwindcss').Config} */
module.exports = {
  darkMode: ["class"],
  content: [
    "./src/pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/components/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/app/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      colors: {
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "#2563EB", // blue-600
          foreground: "#FFFFFF",
          50: "#EFF6FF",
          100: "#DBEAFE",
          200: "#BFDBFE",
          300: "#93C5FD",
          400: "#60A5FA",
          500: "#3B82F6",
          600: "#2563EB", // Brand primary
          700: "#1D4ED8",
          800: "#1E40AF",
          900: "#1E3A8A",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "#F59E0B", // amber-500
          foreground: "hsl(var(--accent-foreground))",
          50: "#FFFBEB",
          100: "#FEF3C7",
          200: "#FDE68A",
          300: "#FCD34D",
          400: "#FBBF24",
          500: "#F59E0B", // Brand accent
          600: "#D97706",
          700: "#B45309",
          800: "#92400E",
          900: "#78350F",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
        slate: {
          850: "#1E293B", // Custom dark shade
          900: "#0F172A", // dark slate-900 background
          950: "#020617",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      keyframes: {
        "accordion-down": {
          from: { height: "0" },
          to: { height: "var(--radix-accordion-content-height)" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)" },
          to: { height: "0" },
        },
        "fade-in": {
          from: { opacity: "0" },
          to: { opacity: "1" },
        },
        "slide-in-from-top": {
          from: { transform: "translateY(-100%)" },
          to: { transform: "translateY(0)" },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
        "fade-in": "fade-in 0.3s ease-out",
        "slide-in-from-top": "slide-in-from-top 0.3s ease-out",
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
}
```

---

```typescript
import type { Config } from "tailwindcss";

const config: Config = {
  darkMode: ["class"],
  content: [
    "./src/pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/components/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/app/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      colors: {
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "#2563EB", // blue-600
          foreground: "#FFFFFF",
          50: "#EFF6FF",
          100: "#DBEAFE",
          200: "#BFDBFE",
          300: "#93C5FD",
          400: "#60A5FA",
          500: "#3B82F6",
          600: "#2563EB", // Brand primary
          700: "#1D4ED8",
          800: "#1E40AF",
          900: "#1E3A8A",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "#F59E0B", // amber-500
          foreground: "hsl(var(--accent-foreground))",
          50: "#FFFBEB",
          100: "#FEF3C7",
          200: "#FDE68A",
          300: "#FCD34D",
          400: "#FBBF24",
          500: "#F59E0B", // Brand accent
          600: "#D97706",
          700: "#B45309",
          800: "#92400E",
          900: "#78350F",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
        slate: {
          850: "#1E293B",
          900: "#0F172A", // dark slate-900 background
          950: "#020617",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      keyframes: {
        "accordion-down": {
          from: { height: "0" },
          to: { height: "var(--radix-accordion-content-height)" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)" },
          to: { height: "0" },
        },
        "fade-in": {
          from: { opacity: "0" },
          to: { opacity: "1" },
        },
        "slide-in-from-top": {
          from: { transform: "translateY(-100%)" },
          to: { transform: "translateY(0)" },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
        "fade-in": "fade-in 0.3s ease-out",
        "slide-in-from-top": "slide-in-from-top 0.3s ease-out",
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
};

export default config;
```

---

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 6.5%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;
    --primary: 217.2 91.2% 59.8%;
    --primary-foreground: 222.2 47.4% 11.2%;
    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 38 92% 50%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 224.3 76.3% 48%;
    --radius: 0.5rem;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-slate-900 text-foreground;
    font-feature-settings: "rlig" 1, "calt" 1;
  }
}

/* Custom scrollbar for dark theme */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: hsl(var(--muted));
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: hsl(var(--muted-foreground) / 0.3);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: hsl(var(--muted-foreground) / 0.5);
}

/* Animation utilities */
@utility animate-in {
  animation: fade-in 0.3s ease-out;
}
```

---

```typescript
import { createBrowserClient } from '@supabase/ssr';
import type { Database } from '@/types/database';

let client: ReturnType<typeof createBrowserClient<Database>> | undefined;

/**
 * Browser-side Supabase client (singleton pattern)
 * Use in Client Components, API routes, and other client-side contexts
 */
export function getSupabaseBrowserClient() {
  if (client) {
    return client;
  }

  client = createBrowserClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );

  return client;
}
```

---

```typescript
import { createServerClient } from '@supabase/ssr';
import { cookies } from 'next/headers';
import type { Database } from '@/types/database';

/**
 * Server-side Supabase client for Server Components
 * Uses getAll/setAll cookie pattern (REQUIRED for @supabase/ssr)
 */
export async function getSupabaseServerClient() {
  const cookieStore = await cookies();

  return createServerClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll();
        },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) => {
              cookieStore.set(name, value, options);
            });
          } catch {
            // This can fail in Server Components during initial render
            // The error is safely ignored as cookies are set in middleware
          }
        },
      },
    }
  );
}
```

---

```typescript
import { createServerClient } from '@supabase/ssr';
import { NextResponse, type NextRequest } from 'next/server';
import type { Database } from '@/types/database';

/**
 * Supabase client for Next.js Middleware
 * Handles auth token refresh and request

## pages-builder
I'll build all 10 pages with production-grade code. Let me start by creating the foundational files and then implement each page.

```typescript
// apps/web/src/types/database.ts
// Auto-generated by Supabase
export type Json =
  | string
  | number
  | boolean
  | null
  | { [key: string]: Json | undefined }
  | Json[]

export interface Database {
  public: {
    Tables: {
      profiles: {
        Row: {
          id: string
          email: string
          full_name: string | null
          company_name: string | null
          job_title: string | null
          phone: string | null
          twilio_number: string | null
          sender_email: string | null
          avatar_url: string | null
          created_at: string
          updated_at: string
        }
        Insert: {
          id: string
          email: string
          full_name?: string | null
          company_name?: string | null
          job_title?: string | null
          phone?: string | null
          twilio_number?: string | null
          sender_email?: string | null
          avatar_url?: string | null
          created_at?: string
          updated_at?: string
        }
        Update: {
          id?: string
          email?: string
          full_name?: string | null
          company_name?: string | null
          job_title?: string | null
          phone?: string | null
          twilio_number?: string | null
          sender_email?: string | null
          avatar_url?: string | null
          created_at?: string
          updated_at?: string
        }
      }
      contacts: {
        Row: {
          id: string
          user_id: string
          first_name: string
          last_name: string
          email: string
          phone: string
          company: string | null
          job_title: string | null
          notes: string | null
          source: string | null
          status: string
          claimed: boolean
          created_at: string
          updated_at: string
        }
        Insert: {
          id?: string
          user_id: string
          first_name: string
          last_name: string
          email: string
          phone: string
          company?: string | null
          job_title?: string | null
          notes?: string | null
          source?: string | null
          status?: string
          claimed?: boolean
          created_at?: string
          updated_at?: string
        }
        Update: {
          id?: string
          user_id?: string
          first_name?: string
          last_name?: string
          email?: string
          phone?: string
          company?: string | null
          job_title?: string | null
          notes?: string | null
          source?: string | null
          status?: string
          claimed?: boolean
          created_at?: string
          updated_at?: string
        }
      }
      conversations: {
        Row: {
          id: string
          contact_id: string
          user_id: string
          direction: 'inbound' | 'outbound'
          channel: 'sms' | 'email'
          content: string
          twilio_sid: string | null
          status: 'pending' | 'sent' | 'delivered' | 'failed'
          created_at: string
        }
        Insert: {
          id?: string
          contact_id: string
          user_id: string
          direction: 'inbound' | 'outbound'
          channel: 'sms' | 'email'
          content: string
          twilio_sid?: string | null
          status?: 'pending' | 'sent' | 'delivered' | 'failed'
          created_at?: string
        }
        Update: {
          id?: string
          contact_id?: string
          user_id?: string
          direction?: 'inbound' | 'outbound'
          channel?: 'sms' | 'email'
          content?: string
          twilio_sid?: string | null
          status?: 'pending' | 'sent' | 'delivered' | 'failed'
          created_at?: string
        }
      }
      claims: {
        Row: {
          id: string
          claim_code: string
          contact_id: string
          user_id: string | null
          claimed_at: string | null
          created_at: string
        }
        Insert: {
          id?: string
          claim_code: string
          contact_id: string
          user_id?: string | null
          claimed_at?: string | null
          created_at?: string
        }
        Update: {
          id?: string
          claim_code?: string
          contact_id?: string
          user_id?: string | null
          claimed_at?: string | null
          created_at?: string
        }
      }
    }
  }
}

export type Profile = Database['public']['Tables']['profiles']['Row']
export type Contact = Database['public']['Tables']['contacts']['Row']
export type Conversation = Database['public']['Tables']['conversations']['Row']
export type Claim = Database['public']['Tables']['claims']['Row']
```

```typescript
// apps/web/src/lib/utils/cn.ts
import { type ClassValue, clsx } from 'clsx'
import { twMerge } from 'tailwind-merge'

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
```

```typescript
// apps/web/src/lib/utils/formatters.ts
import { format, formatDistanceToNow } from 'date-fns'

export function formatDate(date: string | Date): string {
  return format(new Date(date), 'MMM d, yyyy')
}

export function formatDateTime(date: string | Date): string {
  return format(new Date(date), 'MMM d, yyyy h:mm a')
}

export function formatRelativeTime(date: string | Date): string {
  return formatDistanceToNow(new Date(date), { addSuffix: true })
}

export function formatPhoneNumber(phone: string): string {
  const cleaned = phone.replace(/\D/g, '')
  if (cleaned.length === 10) {
    return `(${cleaned.slice(0, 3)}) ${cleaned.slice(3, 6)}-${cleaned.slice(6)}`
  }
  if (cleaned.length === 11 && cleaned[0] === '1') {
    return `+1 (${cleaned.slice(1, 4)}) ${cleaned.slice(4, 7)}-${cleaned.slice(7)}`
  }
  return phone
}

export function formatInitials(name: string): string {
  return name
    .split(' ')
    .map((n) => n[0])
    .join('')
    .toUpperCase()
    .slice(0, 2)
}
```

```typescript
// apps/web/src/app/globals.css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 6.5%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;
    --primary: 217.2 91.2% 59.8%;
    --primary-foreground: 222.2 47.4% 11.2%;
    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 38 92% 50%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 224.3 76.3% 48%;
    --radius: 0.5rem;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-slate-900 text-foreground;
    font-feature-settings: "rlig" 1, "calt" 1;
  }
}

::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: hsl(var(--muted));
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: hsl(var(--muted-foreground) / 0.3);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: hsl(var(--muted-foreground) / 0.5);
}

@utility animate-in {
  animation: fade-in 0.3s ease-out;
}
```

```typescript
// apps/web/src/components/ui/button.tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils/cn"

const buttonVariants = cva(
  "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive: "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline: "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary: "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }
```

```typescript
// apps/web/src/components/ui/input.tsx
import * as React from "react"
import { cn } from "@/lib/utils/cn"

export interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {}

const Input = React.forwardRef<HTMLInputElement, InputProps>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }
```

```typescript
// apps/web/src/components/ui/card.tsx
import * as React from "react"
import { cn } from "@/lib/utils/cn"

const Card = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div
      ref={ref}
      className={cn("rounded-lg border bg-card text-card-foreground shadow-sm", className)}
      {...props}
    />
  )
)
Card.displayName = "Card"

const CardHeader = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("flex flex-col space-y-1.5 p-6", className)} {...props} />
  )
)
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLHeadingElement>>(
  ({ className, ...props }, ref) => (
    <h3
      ref={ref}
      className={cn("text-2xl font-semibold leading-none tracking-tight", className)}
      {...props}
    />
  )
)
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(
  ({ className, ...props }, ref) => (
    <p ref={ref} className={cn("text-sm text-muted-foreground", className)} {...props} />
  )
)
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
  )
)
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("flex items-center p-6 pt-0", className)} {...props} />
  )
)
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }
```

```typescript
// apps/web/src/components/ui/label.tsx
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils/cn"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> & VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root ref={ref} className={cn(labelVariants(), className)} {...props} />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }
```

```typescript
// apps/web/src/components/ui/textarea.tsx
import * as React from "react"
import { cn } from "@/lib/utils/cn"

export interface TextareaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}

const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ className, ...props }, ref) => {
    return (
      <textarea
        className={cn(
          "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Textarea.displayName = "Textarea"

export { Textarea }
```

```typescript
// apps/web/src/components/ui/avatar.tsx
"use client"

import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"
import { cn } from "@/lib/utils/cn"

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full", className)}
    {...props}
  />
))
Avatar.displayName = AvatarPrimitive.Root.displayName

const